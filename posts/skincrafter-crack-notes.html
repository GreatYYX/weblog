<!DOCTYPE html>
<html lang="zh-cn">
<head>

    <title>  GreatYYX Blog - SkinCrafterç ´è§£ç¬”è®°
</title>

  <meta charset="utf-8">
  <link rel="dns-prefetch" href="http://yyx.name"/>
  <link rel="dns-prefetch" href="http://www.yyx.name"/>
  <link rel="dns-prefetch" href="http://blog.yyx.name"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="GreatYYX">
  <meta name="robots" content="all">
  <meta name="generator" content="pelican,github,githubpage,jquery,bootstrap,pjax">
  <meta name="description" content="program,guitar,photo,information,security,ctf,writeup,debug">
  <meta name="description" content="ç¼–ç¨‹,å¼€å‘,éŸ³ä¹,å‰ä»–,æ‘„å½±,ä¿¡æ¯å®‰å…¨,æå®¢,è°ƒè¯•">
  <meta name="baidu-site-verification" content="U9HmJyJXz6" />
  <meta name="google-site-verification" content="9dDxioopwKNhApH1U_Jzy8_Cf7BCLFW5UTUqiTQLG9A" />
  <link rel="shortcut icon" href="http://yyxname.qiniudn.com/theme/img/favicon.ico">
  
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="http://yyxname.qiniudn.com/theme/css/main.min.css" />
  <!--[if lt IE 9]>
    <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->

  <link href="http://blog.yyx.name/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="GreatYYX Blog Full Atom Feed" />
  <link href="http://blog.yyx.name/feeds/security.atom.xml" type="application/atom+xml" rel="alternate" title="GreatYYX Blog Categories Atom Feed" />


    <meta name="tags" contents="SkinCrafter,crack,reversing,çš®è‚¤,ç ´è§£,é€†å‘" />

</head>

<body>


<div id="wrapper">
  <div id="nav-main" class="navbar navbar-inverse" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a data-pjax class="navbar-brand" href="http://blog.yyx.name/index.html">
          <img alt="Brand" height="60" width="60" src="http://yyxname.qiniudn.com/theme/img/logo.png">
        </a>
      </div>
      <div class="navbar-collapse collapse">

        <ul class="nav navbar-nav navbar-right">
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Category <span class="caret"></span></a>
            <ul class="dropdown-menu" role="menu">
    <li><a data-pjax href="http://blog.yyx.name/category/music.html">Music</a></li>
    <li><a data-pjax href="http://blog.yyx.name/category/security.html">Security</a></li>
    <li><a data-pjax href="http://blog.yyx.name/category/web.html">Web</a></li>
            </ul>
          </li>
          <li><a target="_blank" href="http://photo.yyx.name">Photography</a></li>
          <li><a data-pjax href="http://blog.yyx.name/pages/about.html">About</a></li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
              <span class="glyphicon glyphicon-search"></span>
            </a>
            <ul class="dropdown-menu" role="menu">
              <li>
                <form class="navbar-form">
                <input id="search-input" type="text" class="form-control" placeholder="Search...">
                </form>
              </li>
            </ul>
          </li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
              <span class="glyphicon glyphicon-share"></span>
            </a>
            <ul class="dropdown-menu" role="menu">
              <li><a href="http://weibo.com/u/1085956311" target="_blank"><i class="fa fa-weibo"></i>&nbsp;Weibo</a></li>
              <li><a href="http://github.com/GreatYYX"  target="_blank"><i class="fa fa-github"></i>&nbsp;Github</a></li>
            </ul>
          </li>

        </ul>
      </div>
    </div>
  </div><!-- /.navbar -->
    
  <div class="container" id="main-container">
    <div class="row row-offcanvas row-offcanvas-right">
<div id="blog-main" class="col-sm-8 blog-main">
  <h1 class="blog-post-title">SkinCrafterç ´è§£ç¬”è®°</h1>
  <p class="blog-post-meta">
    <i class="fa fa-clock-o"></i>&nbsp;2014-11-09
    &nbsp;&nbsp;|&nbsp;&nbsp;
    <i class="fa fa-folder-o"></i>&nbsp;<a data-pjax href="http://blog.yyx.name/category/security.html">Security</a>
  </p>
  <div class="blog-post" >
    <h1>å¼€ç¯‡åºŸè¯</h1>
<p>æœ€è¿‘çš„ä¸€ä¸ªWinä¸‹çš„å°é¡¹ç›®ï¼Œå›¾å½¢ç•Œé¢éœ€æ±‚ç®€å•ï¼Œå°±ç›´æ¥ä¸ŠMFCã€‚å®ŒæˆåæŸäººè§‰å¾—ç•Œé¢ä¸å¤Ÿå’Œè°ï¼Œäºæ˜¯å¾—æŠ˜è…¾ä¸‹ç•Œé¢ã€‚è²Œä¼¼ç›®å‰VC++ç•Œçš„UIä¸»æµæ˜¯MSè‡ªå®¶DirectUIæ€æƒ³ä¸‹çš„ä¸€äº›UIåº“ï¼Œå¯æƒœæœ¬äººçš„å“²å­¦â€œæ‡’â€å­—å½“å¤´ï¼Œå†å­¦ä¸€å¥—UIçš„ç”¨æ³•å®åœ¨æ˜¯è¦äº†äº²å‘½ï¼Œç›´æ¥æ”¾å¼ƒã€‚è®°å¾—æœ¬ç§‘æœŸé—´ç”¨è¿‡ä¸€ä¸ªSkin++çš„çš®è‚¤åº“ï¼ŒåŠ è½½åå¯ä»¥ç›´æ¥æ¢è‚¤ï¼Œå¯æƒœé‚£ç©æ„çš®è‚¤å¤ªå°‘ã€æ²¡æœ‰çš®è‚¤ç¼–è¾‘å™¨è€Œä¸”è²Œä¼¼å·²ç»åœæ­¢ç»´æŠ¤ï¼Œå› æ­¤ä½œç½¢ã€‚ågoogleåˆ°åŒä¸ºçš®è‚¤åº“çš„SkinCrafterï¼Œå¹¶ä¸‹äº†3.4.4çš„ç ´è§£ç‰ˆï¼Œå¯æƒœåœ¨VS2010ä¸‹æ•´åˆåMessageBoxçš„æŒ‰é’®åº•è‰²åœ¨Win7ä¸‹æ— æ³•åŒ¹é…çš®è‚¤è®¾ç½®ï¼ˆå®˜ç½‘æŸ¥é˜…åå‘ç°æ˜¯bugï¼Œæ–°ç‰ˆå·²è§£å†³ï¼‰ï¼Œé‚æ¢åˆ°3.8.0ã€‚è¯¥ç‰ˆæœ¬çš„VS2012æœ‰ç›¸å…³ç ´è§£ç‰ˆï¼Œä½†VS2010æ²¡æœ‰ï¼Œäºæ˜¯è‡ªå·±ä¸Šæ‰‹ç ´è§£ï¼ˆæ­£æ‰€è°“å­¦ä¼šç ´è§£ï¼Œç”¨Dç‰ˆè½¯ä»¶éƒ½æœ‰åº•æ°”äº†ï¼‰ï¼ŒèŠ±äº†å·®ä¸å¤šå¿«2å°æ—¶æœ€ç»ˆæˆåŠŸï¼Œå¹¶è®°å½•æˆæœ¬æ–‡ã€‚</p>
<h1>Dllç‰ˆå·¥ä½œæµç¨‹</h1>
<p>å¯¹äºVC/MFCç¨‹åºï¼ŒSkinCrafteræœ‰Dll/ActiveXä¸¤ä¸ªç‰ˆæœ¬ï¼Œæˆ‘ä¸ªäººå–œæ¬¢ä½¿ç”¨Dllç‰ˆï¼ˆä¸¤ä¸ªç‰ˆæœ¬çš„ç ´è§£æ–¹æ³•å…¶å®æ˜¯ä¸€æ ·çš„ï¼‰ã€‚ä¸‹é¢ä»‹ç»Dllç‰ˆæœ¬å®˜æ–¹çš„ä½¿ç”¨æ–¹æ³•ï¼š</p>
<ol>
<li>é¦–å…ˆéœ€è¦å¼•å…¥CSCSkin.hå’ŒCSCSkin.cppæ–‡ä»¶ï¼Œå¹¶å°†dllåŠçš®è‚¤æ–‡ä»¶.skfæ”¾åœ¨ç›®å½•ä¸‹ã€‚</li>
<li>å®ä¾‹åŒ–CSCSkinå¯¹è±¡m_skinï¼Œå¹¶åœ¨Appçš„InitInstance()ä¸­æ‰§è¡ŒInit()ã€LoadSkinFromFile()åŠApplySkin()ä¸‰ä¸ªå‡½æ•°ã€‚</li>
</ol>
<p>å¯¹æ¯”ActiveXç‰ˆæœ¬ï¼Œå¯ä»¥å‘ç°å°‘æ‰§è¡Œå¥½å‡ ä¸ªå‡½æ•°ï¼Œå…¶å®è¿™äº›å‡½æ•°åœ¨Init()æ–¹æ³•ä¸­éƒ½å®Œæˆäº†ï¼Œæ‰€ä»¥çœŸæ­£çš„å·¥ä½œæµç¨‹æ˜¯ï¼š</p>
<ol>
<li>å®šä¹‰äº†Dllå¯¼å‡ºè¡¨ä¸­æ‰€æœ‰çš„å‡½æ•°æŒ‡é’ˆã€‚</li>
<li>é€šè¿‡LoadLibrary()åŠ è½½Dllï¼Œå¹¶æ‰§è¡ŒInitLicenKeys()å’ŒInitDecoration()ã€‚</li>
<li>LoadSkinFromFile()åŠ è½½çš®è‚¤ã€‚</li>
<li>ApplySkin()åº”ç”¨çš®è‚¤ã€‚</li>
</ol>
<h1>InitLicenKeyså‡½æ•°ç ´è§£</h1>
<p>è¿™ä¸ªå‡½æ•°ç”¨äºå†™å…¥æ³¨å†Œä¿¡æ¯ï¼Œå¯¹äºDEMOç‰ˆï¼Œè¯¥å‡½æ•°çš„4ä¸ªå‚æ•°æ˜¯å®šæ­»çš„ã€‚å…¶å®ä¸ç ´è§£è¿™ä¸ªå‡½æ•°ä¹Ÿæ— æ‰€è°“ï¼Œåæ­£å†™åœ¨ç¨‹åºé‡Œé¢ï¼Œä½†æ˜¯çœŸè¦ç ´è§£ä¹Ÿå¾ˆç®€å•ã€‚</p>
<p>ç”±äºæ˜¯ç®€å•çš„å›ºå®šå­—ç¬¦ä¸²åŒ¹é…ï¼Œå› æ­¤å¯ä»¥ç›´æ¥æ›¿æ¢Dllä¸­çš„å­—ç¬¦ä¸²ã€‚å½“ç„¶è¿˜å¯ä»¥é‡‡ç”¨çˆ†ç ´çš„æ–¹æ³•ï¼Œè¿™æ ·æ— è®ºè¾“å…¥ä»€ä¹ˆéƒ½è¡Œã€‚</p>
<p>æŸ¥æ‰¾å››ä¸ªå‚æ•°ä¸­ä»»æ„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ‘è¿™å„¿ç”¨DEMOSKINCRAFTERLICENCEï¼ˆæ¯”è¾ƒæœ‰ä»£è¡¨æ€§ï¼‰ï¼Œå®šä½åˆ°ç¨‹åºã€‚å‘ç°æœ‰ä¸¤ä¸ªå¤„strcmp()æ¯”è¾ƒå­—ç¬¦ä¸²å¹¶ä½œå‡ºæ¯”è¾ƒå’Œè·³è½¬ï¼Œå› æ­¤ç›´æ¥nopæ‰è·³è½¬å³å¯ã€‚</p>
<pre><code class="x86asm">...
10005A49  |&gt; \85C0          test eax,eax
10005A4B  |.  75 48         jnz XSkinCraf.10005A95                   ;  ç¬¬ä¸€æ¬¡è·³è½¬åˆ¤æ–­
10005A4D  |.  8B45 14       mov eax,[arg.4]
10005A50  |.  B9 8C420610   mov ecx,SkinCraf.1006428C                ;  DEMOSKINCRAFTERLICENCE
...
10005A7A  |&gt;  85C0          test eax,eax
10005A7C  |.  75 17         jnz XSkinCraf.10005A95                   ;  ç¬¬äºŒæ¬¡è·³è½¬åˆ¤æ–­
10005A7E  |.  5E            pop esi
10005A7F  |.  B8 01000000   mov eax,0x1
10005A84  |.  5B            pop ebx
10005A85  |.  8B4D FC       mov ecx,[local.1]
10005A88  |.  33CD          xor ecx,ebp
10005A8A  |.  E8 E91E0500   call SkinCraf.10057978
10005A8F  |.  8BE5          mov esp,ebp
10005A91  |.  5D            pop ebp
10005A92  |.  C2 1000       retn 0x10
10005A95  |&gt;  6A 00         push 0x0                                 ; /Style = MB_OK|MB_APPLMODAL
10005A97  |.  68 80420610   push SkinCraf.10064280                   ; |SkinCrafter
10005A9C  |.  68 D8410610   push SkinCraf.100641D8                   ; |You are using DEMO version of SkinCrafter. InitLicenKeys function parameters should be: SKINCRAFTER, SKINCRAFTER.COM, support@skincrafter.com, DEMOSKINCRAFTERLICENCE
10005AA1  |.  6A 00         push 0x0                                 ; |hOwner = NULL
10005AA3  |.  FF15 4C350610 call dword ptr ds:[&lt;&amp;USER32.MessageBoxA&gt;&gt;; \MessageBoxA
...
</code></pre>

<h1>å»é™¤å¼¹å‡ºæ¡†</h1>
<p>æœ€æ˜æ˜¾çš„è«è¿‡äºè¿™ä¸ªå¼¹å‡ºæ¡†ï¼Œç¨‹åºå¯åŠ¨åå°±ä¼šå‡ºç°ã€‚è¯¥å¼¹å‡ºæ¡†æ— è¾¹æ¡†å¯æ‹–åŠ¨ï¼Œè€Œä¸”å¼ºåˆ¶ç½®é¡¶ï¼ˆTOP_MOSTï¼‰ï¼Œå› æ­¤æƒ³åˆ°SetWindowPos()åŠSetWindowLong()ä¸¤ä¸ªå‡½æ•°ï¼Œä»”ç»†æŸ¥æ‰¾åå‡æ— æœã€‚åæ¥åˆæŸ¥æ‰¾äº†CreateWindow()ã€CreateRectRgn()åŠCreateRectRgnIndirect()ä¹Ÿæ²¡æœ‰å¾ˆå¥½çš„ä¸‹æ‰‹ä½ç½®ã€‚å°±åœ¨æ‰¾å‡½æ•°è¿™æ¡æ€è·¯æ²¡æœ‰çªç ´å£çš„æ—¶å€™ï¼Œçœ‹åˆ°å¼¹å‡ºçª—å£ä¸Šæœ‰ä¸€æ¡å¯ä»¥ç‚¹å‡»çš„ç½‘å€ï¼Œå› æ­¤ç›´æ¥æŸ¥å­—ç¬¦ä¸²æ‰¾è¿™ä¸ªç½‘å€ï¼Œç„¶åè·³è½¬åˆ°ç¨‹åºå¤„ã€‚</p>
<p>æ‰¾åˆ°ç¨‹åºå¤„ä¹‹åç¿»çœ‹ä¸Šä¸‹æ–‡ï¼Œæ— éå°±åœ¨loadä¸€äº›èµ„æºï¼Œçªç„¶çœ‹åˆ°ShowWindow()å‡½æ•°ã€‚</p>
<pre><code class="x86asm">10002F40  /$  55            push ebp
10002F41  |.  8BEC          mov ebp,esp
...
10002F87  |.  68 F3000000   push 0xF3
10002F8C  |.  6A 02         push 0x2
10002F8E  |.  68 F3000000   push 0xF3
10002F93  |.  E8 D6410500   call &lt;jmp.&amp;mfc100.#AfxFindResourceHandle_1900&gt;
10002F98  |.  50            push eax                                             ; |hInst
10002F99  |.  FF15 70350610 call dword ptr ds:[&lt;&amp;USER32.LoadBitmapW&gt;]            ; \LoadBitmapW
10002F9F  |.  50            push eax
10002FA0  |.  B9 CC450710   mov ecx,SkinCraf.100745CC
10002FA5  |.  E8 BE410500   call &lt;jmp.&amp;mfc100.#CGdiObject::Attach_2184&gt;
10002FAA  |.  A1 D0450710   mov eax,dword ptr ds:[0x100745D0]
10002FAF  |.  A3 D85F0710   mov dword ptr ds:[0x10075FD8],eax
10002FB4  |.  391D DC5F0710 cmp dword ptr ds:[0x10075FDC],ebx
10002FBA  |.  0F85 7C020000 jnz SkinCraf.1000323C
...
10003143  |.  A1 E05F0710   mov eax,dword ptr ds:[0x10075FE0]
10003148  |.  6A 01         push 0x1
1000314A  |.  51            push ecx
1000314B  |.  8BCC          mov ecx,esp
1000314D  |.  8965 DC       mov [local.9],esp
10003150  |.  68 843D0610   push SkinCraf.10063D84                               ;  http://www.skincrafter.com/order.html
10003155  |.  C780 84000000&gt;mov dword ptr ds:[eax+0x84],0x497D
1000315F  |.  FF15 A4390610 call dword ptr ds:[&lt;&amp;mfc100.#ATL::CStringT&lt;char,StrT&gt;;  mfc100.#ATL::CStringT&lt;char,StrTraitMFC_DLL&lt;char,ATL::ChTraitsCRT&lt;char&gt; &gt; &gt;::CStringT&lt;char,StrTraitMFC_DLL&lt;char,ATL::ChTraitsCRT&lt;char&gt; &gt; &gt;_310
10003165  |.  8B0D E05F0710 mov ecx,dword ptr ds:[0x10075FE0]
...
1000323C  |&gt;  8B0D DC5F0710 mov ecx,dword ptr ds:[0x10075FDC]
10003242  |.  6A 05         push 0x5
10003244  |.  E8 35410500   call &lt;jmp.&amp;mfc100.#CWnd::ShowWindow_12962&gt;
...
</code></pre>

<p>å¯ä»¥çœ‹åˆ°ï¼Œå‡½æ•°æ‰§è¡Œå®Œæˆä¹‹åä¼šShowWindow()ï¼Œè€Œå½“å‚æ•°ä¸º5çš„æ—¶å€™ï¼Œå°±æ˜¯SW_SHOWï¼Œå› æ­¤å¯ä»¥å°†pushçš„å‚æ•°è®¾ç½®ä¸º0(SW_HIDE)æˆ–è€…ç›´æ¥æŠŠæ•´åˆå‡½æ•°nopæ‰ã€‚</p>
<p><strong>2014-12-03æ›´æ–°ï¼š</strong></p>
<p>ä»Šå¤©åœ¨é¡¹ç›®ä¸Šè°ƒè¯•çš„æ—¶å€™å‘ç°åˆå‡ºç°å¼¹çª—ï¼Œä½¿ç”¨ç›¸åŒçš„dllåœ¨çš®è‚¤æµ‹è¯•ç¨‹åºä¸Šåˆ™æ²¡æœ‰å‡ºç°ã€‚äºæ˜¯ç›´æ¥è°ƒè¯•é¡¹ç›®ç¨‹åºï¼Œå‘ç°è¿˜æœ‰å‡ å¤„ShowWindowå‡½æ•°ã€‚</p>
<pre><code class="x86asm">10012B40  /$  55            push ebp
10012B41  |.  8BEC          mov ebp,esp
10012B43  |.  833D D45F0710&gt;cmp dword ptr ds:[0x10075FD4],0x0
10012B4A  |.  56            push esi
10012B4B  |.  8BF1          mov esi,ecx
10012B4D  |.  75 42         jnz XSkinCraf.10012B91
10012B4F  |.  8B0D DC5F0710 mov ecx,dword ptr ds:[0x10075FDC]
10012B55  |.  6A 05         push 0x5
10012B57  |.  E8 22480400   call &lt;jmp.&amp;mfc100.#CWnd::ShowWindow_12962&gt;
10012B5C  |.  8B0D DC5F0710 mov ecx,dword ptr ds:[0x10075FDC]
10012B62  |.  6A 00         push 0x0
10012B64  |.  6A 08         push 0x8
10012B66  |.  6A 00         push 0x0
10012B68  |.  E8 8B490400   call &lt;jmp.&amp;mfc100.#CWnd::ModifyStyle_7889&gt;
10012B6D  |.  8B0D E05F0710 mov ecx,dword ptr ds:[0x10075FE0]
10012B73  |.  6A 05         push 0x5
10012B75  |.  E8 04480400   call &lt;jmp.&amp;mfc100.#CWnd::ShowWindow_12962&gt;
10012B7A  |.  8B0D E45F0710 mov ecx,dword ptr ds:[0x10075FE4]
10012B80  |.  6A 05         push 0x5
10012B82  |.  E8 F7470400   call &lt;jmp.&amp;mfc100.#CWnd::ShowWindow_12962&gt;
10012B87  |.  C705 D45F0710&gt;mov dword ptr ds:[0x10075FD4],0x1
10012B91  |&gt;  8B46 18       mov eax,dword ptr ds:[esi+0x18]
10012B94  |.  85C0          test eax,eax
10012B96  |.  74 74         je XSkinCraf.10012C0C
...
</code></pre>

<p>å¯ç›´æ¥åœ¨ODçš„Nameè¡¨ä¸­æ‰¾å‡ºMFCçš„CWnd::ShowWindowå‡½æ•°è°ƒç”¨å¤„å…¨éƒ¨ä¸‹æ–­ï¼Œæ­¤å¤„è¿ç»­å‡ºç°3å¤„ShowWindow()ï¼Œå°†ç¬¬ä¸€æ¬¡å‡ºç°å¤„çš„<code>push 0x5</code>æ”¹æˆ<code>push 0x0</code>å³å¯ã€‚</p>
<h1>å»é™¤æ ‡é¢˜æ DEMOå­—æ ·</h1>
<p>æœ¬ä»¥ä¸ºè¿™æ­¥ä¼šå¾ˆç®€å•ï¼Œå¾ˆå¯æƒœï¼Œä½ä¼°äº†ä½œè€…çš„æ™ºå•†ã€‚ç›´æ¥æ‰¾å­—ç¬¦ä¸²æ²¡çœ‹åˆ°SkinCrafter Demoå­—æ ·ï¼Œå› æ­¤æ€€ç–‘å¾ˆå¯èƒ½å­—ç¬¦ä¸²æ˜¯è¢«åŠ å¯†çš„äº†ã€‚ODè°ƒè¯•Dllä¼šåŠ è½½LoadDll.exeè¿™ä¸ªç¨‹åºï¼Œå¹¶åœ¨DllåŠ è½½åå…è®¸é€šè¿‡æ¥å£æ‰§è¡ŒDllçš„å¯¼å‡ºå‡½æ•°ï¼Œå¯¹äºä¸€èˆ¬ä½œä¸ºå‡½æ•°åº“çš„Dllè¿™æ ·è°ƒè¯•å½“ç„¶æ²¡é—®é¢˜ï¼Œæ¯ä¸ªå‡½æ•°éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä½†æ˜¯å¯¹äºè¿™ç§å‡½æ•°ä¹‹é—´æœ‰æ•°æ®ä¾èµ–çš„Dllæ¥è¯´ï¼Œæˆ‘å¿…é¡»å…ˆè°ƒç”¨å‡ ä¸ªä¾èµ–çš„å‡½æ•°ï¼Œè¿™æ ·å°±è¿‡äºéº»çƒ¦äº†ï¼ˆä¸»è¦æ‡’å¾—è¾“é‚£ä¹ˆé•¿çš„å‚æ•°ï¼Œè¿˜è¦å°ç«¯ç ï¼Œè€Œä¸”æ¯æ¬¡åŠ è½½éƒ½è¦è¾“å…¥â€¦â€¦ï¼‰ã€‚è¿™é‡Œå°±ç”¨åˆ°ä¸€ä¸ªæŠ€å·§ï¼Œè‡ªå·±å†™ä¸€ä¸ªè°ƒç”¨dllçš„exeï¼Œç›´æ¥è°ƒè¯•exeï¼Œå¹¶è¿›å…¥Dllçš„é¢†ç©ºæ‰¾éœ€è¦çš„ä¸œè¥¿ã€‚</p>
<p>åœ¨ODçš„è°ƒè¯•é€‰é¡¹ä¸­ï¼Œæ‰¾åˆ°äº‹ä»¶(Event)é€‰é¡¹å¡ï¼ŒæŠŠâ€œä¸­æ–­äºæ–°æ¨¡å—â€è¿™é¡¹å‹¾ä¸Šï¼Œä¹‹ååŠ è½½exeç¨‹åºã€‚æ¯å½“exeåŠ è½½ä¸€ä¸ªdllçš„æ—¶å€™ï¼Œå°±ä¼šè¢«æ–­ä¸‹ï¼ŒF9ç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°ç›®æ ‡å‡ºç°ã€‚å½“ç„¶SkinCrafterDllè¿™ä¸ªDllæ˜¯åœ¨ç¨‹åºä¸­é€šè¿‡LoadLibrary()åŠ è½½çš„ï¼Œå› æ­¤å…ˆè¦æŠŠç¨‹åºè·‘èµ·æ¥ã€‚</p>
<p>æ–­ä¸‹åè¿›å…¥è¯¥Dllé¢†ç©ºï¼Œå¹¶æŸ¥çœ‹æ‰€æœ‰å‡½æ•°ç¬¦å·ã€‚è€ƒè™‘åˆ°å’Œç»˜å›¾æœ‰å…³ï¼Œå¹¶ç»è¿‡å‡ æ¬¡å®éªŒï¼Œæœ€åå®šä½åœ¨GdiPlusåº“ä¸­çš„GdipDrawString()å‡½æ•°ä¸Šï¼Œç›´æ¥ä¸‹æ–­å‡½æ•°ã€‚ä½†æ˜¯æŸ¥æ‰¾å‡½æ•°å¼•ç”¨çš„æ—¶å€™å´æ²¡æœ‰ç»“æœï¼Œè¿™æ˜¯å› ä¸ºDllåˆšå¼€å§‹å¹¶æ²¡æœ‰å¡«å……IATï¼Œæ‰€ä»¥éœ€è¦å†ç»§ç»­F9ï¼Œç›´åˆ°IATåˆå§‹åŒ–å®Œæ¯•ã€‚å†æŸ¥æ‰¾å¼•ç”¨å°±å¯ä»¥æ‰¾åˆ°å‡½æ•°è°ƒç”¨å¤„äº†ã€‚</p>
<pre><code class="x86asm">...
02E01511  |.  53            push ebx                                             ; /hIcon
02E01512  |.  FF15 0034E102 call dword ptr ds:[&lt;&amp;USER32.DestroyIcon&gt;]            ; \DestroyIcon
02E01518  |&gt;  8B9D 54FFFFFF mov ebx,[local.43]
02E0151E  |&gt;  A1 406CE102   mov eax,dword ptr ds:[0x2E16C40]
02E01523  |.  8B15 3C6CE102 mov edx,dword ptr ds:[0x2E16C3C]
02E01529  |.  8B0D 446CE102 mov ecx,dword ptr ds:[0x2E16C44]
02E0152F  |.  8945 E0       mov [local.8],eax
02E01532  |.  66:A1 4C6CE10&gt;mov ax,word ptr ds:[0x2E16C4C]
02E01538  |.  8955 DC       mov [local.9],edx
02E0153B  |.  8B15 486CE102 mov edx,dword ptr ds:[0x2E16C48]
02E01541  |.  66:8945 EC    mov word ptr ss:[ebp-0x14],ax
02E01545  |.  8D45 DC       lea eax,[local.9]
02E01548  |.  894D E4       mov [local.7],ecx
02E0154B  |.  8955 E8       mov [local.6],edx
02E0154E  |.  33C9          xor ecx,ecx
02E01550  |.  8D70 01       lea esi,dword ptr ds:[eax+0x1]
...
02E017E5  |.  8B8D 64FFFFFF mov ecx,[local.39]
02E017EB  |.  56            push esi
02E017EC  |.  51            push ecx
02E017ED  |.  8B8D 48FFFFFF mov ecx,[local.46]
02E017F3  |.  8D95 F8FEFFFF lea edx,[local.66]
02E017F9  |.  52            push edx
02E017FA  |.  8B95 6CFFFFFF mov edx,[local.37]
02E01800  |.  51            push ecx
02E01801  |.  6A FF         push -0x1
02E01803  |.  50            push eax
02E01804  |.  52            push edx
02E01805  |.  E8 D26D0000   call &lt;jmp.&amp;gdiplus.GdipDrawString&gt;
02E0180A  |.  8B85 64FFFFFF mov eax,[local.39]
02E01810  |.  50            push eax
02E01811  |.  E8 846D0000   call &lt;jmp.&amp;gdiplus.GdipDeleteStringFormat&gt;
02E01816  |.  56            push esi
02E01817  |.  E8 A66C0000   call &lt;jmp.&amp;gdiplus.GdipDeleteBrush&gt;
02E0181C  |.  8B8D 48FFFFFF mov ecx,[local.46]
02E01822  |.  51            push ecx
02E01823  |.  E8 906D0000   call &lt;jmp.&amp;gdiplus.GdipDeleteFont&gt;
02E01828  |.  8B95 6CFFFFFF mov edx,[local.37]
02E0182E  |.  52            push edx
02E0182F  |.  C645 FC 01    mov byte ptr ss:[ebp-0x4],0x1
02E01833  |.  E8 906C0000   call &lt;jmp.&amp;gdiplus.GdipDeleteGraphics&gt;
...
</code></pre>

<p>ç»è¿‡è·Ÿè¸ªï¼Œå¯ä»¥å‘ç°å­—ç¬¦ä¸²åœ¨DestroyIcon()æ‰§è¡Œä¹‹åè¢«è£…å…¥ï¼Œåœ¨å†…å­˜ä¸­æ˜¾ç¤ºä¸ºï¼š</p>
<pre><code class="no-hightlight">02E16C38  80 0F E0 02 54 6C 6E 69 44 75 66 61 73 62 75 27  â‚¬?TlniDufasbu'
02E16C48  43 62 6A 68 27 00 00 00 E4 D9 E1 02 A0 2B E0 02  Cbjh'...æ»Ÿ???
</code></pre>

<p>å› æ­¤å­—ç¬¦ä¸²ä¸ºTlniDufasbu'Cbjh'ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²ç»è¿‡åé¢çš„ç®—æ³•è½¬æ¢æˆäº†SkinCrafter Demoï¼Œå› æ­¤åªè¦ç›´æ¥å¹²æ‰å­—ç¬¦ä¸²å°±å¯ä»¥ï¼Œæˆ–è€…nopæ‰GdipDrawString()ã€‚æˆ‘é‡‡ç”¨åˆ æ‰å­—ç¬¦ä¸²çš„æ–¹æ³•ï¼Œç”¨16è¿›åˆ¶ç¼–è¾‘å™¨æ‰“å¼€dllæ‰¾åˆ°è¿™ä¸ªå­—ç¬¦ä¸²å¹¶å¡«0ã€‚</p>
<h1>åè®°</h1>
<p>ä»æˆ‘ä½¿ç”¨çš„æƒ…å†µæ¥çœ‹æš‚æ—¶æ²¡æœ‰å‡ºç°å…¶ä»–é—®é¢˜ï¼Œå¦‚æœæœ‰ç ´è§£ä¸å®Œå…¨æˆ–é€ æˆé”™è¯¯çš„åœ°æ–¹ï¼Œæˆ‘ä¼šåœ¨åç»­åšå‡ºå®Œå–„ã€‚å¦å¤–ï¼Œæ­¤æ¬¡è°ƒè¯•è¿‡ç¨‹ä¸­å…¨ç¨‹åœ¨IDAä¸­åŒæ­¥å‚è€ƒï¼ŒIDAçš„å›¾å½¢è§†å›¾èƒ½å¾ˆå¥½çš„çœ‹å‡ºç¨‹åºçš„æ‰§è¡Œæµç¨‹ï¼Œå½“ç„¶IDAè¿˜æœ‰ä¸‡æ¶çš„F5å¤§æ€å™¨ :P</p>
  </div><!-- /.blog-post -->
  
  <hr>

  <div id="tag-list" class="tag-list">
    <i class="fa fa-tags"></i>
    <a data-pjax href="http://blog.yyx.name/tag/skincrafter.html">SkinCrafter</a>
    <a data-pjax href="http://blog.yyx.name/tag/crack.html">crack</a>
    <a data-pjax href="http://blog.yyx.name/tag/reversing.html">reversing</a>
    <a data-pjax href="http://blog.yyx.name/tag/pi-fu.html">çš®è‚¤</a>
    <a data-pjax href="http://blog.yyx.name/tag/po-jie.html">ç ´è§£</a>
    <a data-pjax href="http://blog.yyx.name/tag/ni-xiang.html">é€†å‘</a>
  </div>

    <!--comment-->
    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'yyxblog'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</div><!-- /.blog-main -->

<div id="blog-sidebar" class="hidden-xs col-sm-3 col-sm-offset-1">
<div id="sidebar-fix">
    <!--toc-->
    <div class="sidebar-module">
      <!-- <h4>Table of Contents</h4> -->
      <div id="toc" class="toc"></div>
    </div>
</div><!-- ./sidebar-fix -->
</div><!-- /.blog-sidebar -->
    </div><!-- /.row -->
  </div><!-- /.container -->

  <div id="loading" class="fade"><div class="loader"></div></div>

  <div class="blog-footer">
    <p class="l">Â©2015&nbsp;<a href="#">GreatYYX</a>.&nbsp;&nbsp;
      <a rel="license" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a>
    </p>
  </div><!-- /.blog-footer -->

  <div class="float-tool">
    <a id="btn-comment" class="btn hide" title="Comments"><i class="fa fa-comment"></i></a>
    <a id="btn-top" class="btn hide" title="Top"><i class="fa fa-arrow-up"></i></a>
  </div><!-- /.float-tool -->

</div><!-- /.wrapper -->

  <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="http://code.jquery.com/ui/1.11.2/jquery-ui.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
  <script src="http://yyxname.qiniudn.com/theme/js/jquery.tocify.min.js"></script>
  <script src="http://yyxname.qiniudn.com/theme/js/highlight.pack.js"></script>
  <script src="http://yyxname.qiniudn.com/theme/js/jquery.pjax.min.js"></script>
  <script src="http://yyxname.qiniudn.com/theme/js/main.min.js"></script>

    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-64342434-1', 'auto');
    ga('send', 'pageview');
    </script>
<script type="text/javascript">
(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
})(window,document,'script','//s.swiftypecdn.com/install/v1/st.js','_st');

_st('install','XwpC765YWzV58fvrdjoQ');
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>SkinCrafter破解笔记 &ndash; YYX's Website</title>

    <!-- Meta -->
    <meta name="description" content="YYX's Website &ndash; ">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Social -->
    <meta property="article:author" content="YYX" />
    <meta property="article:section" content="Security" />
    <meta property="article:published_time" content="2014-11-09" />

    <meta property="og:type" content="article"/>
    <meta property="og:title" content="SkinCrafter破解笔记"/>
    <meta property="og:description" content="记录了著名VC及.NET皮肤库SkinCrafter(3.8.0 for VS2010)的破解过程，包括license初始化函数破解，弹出框去除以及DEMO文字去除的具体方法及技巧。"/>
    <meta property="og:site_name" content="YYX's Website" />
    <meta property="og:url" content="https://blog.yyx.me/posts/skincrafter-crack-notes/"/>

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="SkinCrafter破解笔记">
    <meta name="twitter:description" content="记录了著名VC及.NET皮肤库SkinCrafter(3.8.0 for VS2010)的破解过程，包括license初始化函数破解，弹出框去除以及DEMO文字去除的具体方法及技巧。">
    <meta name="twitter:url" content="https://blog.yyx.me/posts/skincrafter-crack-notes/">

    <!-- Feed -->
    <link rel="alternate" type="application/atom+xml" href="https://blog.yyx.me/feeds/all.atom.xml" title="YYX's Website Atom Feed" />
    <link rel="alternate" type="application/atom+xml" href="https://blog.yyx.me/feeds/{slug}.atom.xml" title="YYX's Website Categories Atom Feed" />
    <link rel="alternate" type="application/rss+xml" href="http://yyxblog.disqus.com/latest.rss" title="YYX's Website Comments RSS Feed">

    <!-- CSS -->
    <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:regular,bold" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://blog.yyx.me/theme/css/w3.css">
    <link rel="stylesheet" type="text/css" href="https://blog.yyx.me/theme/css/csshake.min.css">
    <link rel="stylesheet" type="text/css" href="https://blog.yyx.me/theme/css/style.css">
    <!-- <link rel="stylesheet" type="text/css" href="https://blog.yyx.me/theme/css/jqcloud.css"> -->
    <link rel="stylesheet" type="text/css" href="https://blog.yyx.me/theme/css/font-awesome.min.css">
    <!-- <link rel="stylesheet" type="text/css" href="https://blog.yyx.me/theme/css/pygments-highlight-github.css"> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow-night-eighties.min.css">

    <!-- Icon -->
    <link rel="shortcut icon" type="image/x-icon" href="/theme/images/favicon-32x32.png">

    <!-- JavaScript -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <!-- <script src="https://blog.yyx.me/theme/js/jqcloud.min.js"></script> -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="https://blog.yyx.me/theme/js/main.js"></script>
  </head>

  <body>
    <div class="w3-row w3-white">
      <header id="header">
        <a href="https://blog.yyx.me/" id="header-logo" title="Home"><img class="shake-crazy" src="https://blog.yyx.me/theme/images/logo_min.svg" width="50" height="50"></a>
        <!-- <a href="https://blog.yyx.me" id="header-logo" title="Home">Y</a> -->
        <nav id="header-menu">
          <a class="w3-bar-item w3-button w3-right w3-hide-large w3-hide-medium" id="nav-expand-btn" href="javascript:void(0)"><i class="fa fa-bars" aria-hidden="true"></i></a>
          <ul class="w3-hide-small">
            <!-- category -->
            <!-- list -->
            <!-- menu item -->
            <li class="w3-border-white w3-hover-opacity"><a href="/posts/">Posts</a></li>
            <li class="w3-border-white w3-hover-opacity"><a href="/gallery/">Gallery</a></li>
            <li class="w3-border-white w3-hover-opacity"><a href="/about/">About</a></li>
            <!-- pages -->
          </ul>
        </nav>
      </header>
    </div>



    <article class="w3-padding-64">
      <header class="w3-container col-main">
        <h1>SkinCrafter破解笔记</h1>
        <div class="post-info">
          <div class="w3-opacity w3-margin-right w3-margin-bottom" style="flex-grow: 1;">
            <span><time datetime="2014-11-09T23:46:00-08:00">Nov 09, 2014</time> @ <a href="https://blog.yyx.me/categories/security/" title="All articles in category Security">Security</a></span>
          </div>
          <div class="w3-margin-right">
            <span class="w3-tag w3-hover-light-grey yyx-text-yellow yyx-tag-transparent">
              <a href="https://blog.yyx.me/tags/skincrafter/" title="All articles with Skincrafter tag">#SkinCrafter</a>
            </span>
            <span class="w3-tag w3-hover-light-grey yyx-text-yellow yyx-tag-transparent">
              <a href="https://blog.yyx.me/tags/crack/" title="All articles with Crack tag">#crack</a>
            </span>
            <span class="w3-tag w3-hover-light-grey yyx-text-yellow yyx-tag-transparent">
              <a href="https://blog.yyx.me/tags/reversing/" title="All articles with Reversing tag">#reversing</a>
            </span>
            <span class="w3-tag w3-hover-light-grey yyx-text-yellow yyx-tag-transparent">
              <a href="https://blog.yyx.me/tags/pi-fu/" title="All articles with 皮肤 tag">#皮肤</a>
            </span>
            <span class="w3-tag w3-hover-light-grey yyx-text-yellow yyx-tag-transparent">
              <a href="https://blog.yyx.me/tags/po-jie/" title="All articles with 破解 tag">#破解</a>
            </span>
            <span class="w3-tag w3-hover-light-grey yyx-text-yellow yyx-tag-transparent">
              <a href="https://blog.yyx.me/tags/ni-xiang/" title="All articles with 逆向 tag">#逆向</a>
            </span>
          </div>
        </div>
      </header>


      <div class="col-main w3-container">
        <section id="content" class="w3-margin-bottom w3-padding-8">
          <h1>开篇废话</h1>
<p>最近的一个Win下的小项目，图形界面需求简单，就直接上MFC。完成后某人觉得界面不够和谐，于是得折腾下界面。貌似目前VC++界的UI主流是MS自家DirectUI思想下的一些UI库，可惜本人的哲学“懒”字当头，再学一套UI的用法实在是要了亲命，直接放弃。记得本科期间用过一个Skin++的皮肤库，加载后可以直接换肤，可惜那玩意皮肤太少、没有皮肤编辑器而且貌似已经停止维护，因此作罢。后google到同为皮肤库的SkinCrafter，并下了3.4.4的破解版，可惜在VS2010下整合后MessageBox的按钮底色在Win7下无法匹配皮肤设置（官网查阅后发现是bug，新版已解决），遂换到3.8.0。该版本的VS2012有相关破解版，但VS2010没有，于是自己上手破解（正所谓学会破解，用D版软件都有底气了），花了差不多快2小时最终成功，并记录成本文。</p>
<h1>Dll版工作流程</h1>
<p>对于VC/MFC程序，SkinCrafter有Dll/ActiveX两个版本，我个人喜欢使用Dll版（两个版本的破解方法其实是一样的）。下面介绍Dll版本官方的使用方法：</p>
<ol>
<li>首先需要引入CSCSkin.h和CSCSkin.cpp文件，并将dll及皮肤文件.skf放在目录下。</li>
<li>实例化CSCSkin对象m_skin，并在App的InitInstance()中执行Init()、LoadSkinFromFile()及ApplySkin()三个函数。</li>
</ol>
<p>对比ActiveX版本，可以发现少执行好几个函数，其实这些函数在Init()方法中都完成了，所以真正的工作流程是：</p>
<ol>
<li>定义了Dll导出表中所有的函数指针。</li>
<li>通过LoadLibrary()加载Dll，并执行InitLicenKeys()和InitDecoration()。</li>
<li>LoadSkinFromFile()加载皮肤。</li>
<li>ApplySkin()应用皮肤。</li>
</ol>
<h1>InitLicenKeys函数破解</h1>
<p>这个函数用于写入注册信息，对于DEMO版，该函数的4个参数是定死的。其实不破解这个函数也无所谓，反正写在程序里面，但是真要破解也很简单。</p>
<p>由于是简单的固定字符串匹配，因此可以直接替换Dll中的字符串。当然还可以采用爆破的方法，这样无论输入什么都行。</p>
<p>查找四个参数中任意一个字符串，我这儿用DEMOSKINCRAFTERLICENCE（比较有代表性），定位到程序。发现有两个处strcmp()比较字符串并作出比较和跳转，因此直接nop掉跳转即可。</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span><span class="w"></span>
<span class="mi">10005</span><span class="n">A49</span><span class="w">  </span><span class="o">|&gt;</span><span class="w"> </span><span class="err">\</span><span class="mi">85</span><span class="n">C0</span><span class="w">          </span><span class="n">test</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="n">eax</span><span class="w"></span>
<span class="mi">10005</span><span class="n">A4B</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">75</span><span class="w"> </span><span class="mi">48</span><span class="w">         </span><span class="n">jnz</span><span class="w"> </span><span class="n">XSkinCraf</span><span class="mf">.10005</span><span class="n">A95</span><span class="w">                   </span><span class="p">;</span><span class="w">  </span><span class="n">第一次跳转判断</span><span class="w"></span>
<span class="mi">10005</span><span class="n">A4D</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">8</span><span class="n">B45</span><span class="w"> </span><span class="mi">14</span><span class="w">       </span><span class="n">mov</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="o">[</span><span class="n">arg.4</span><span class="o">]</span><span class="w"></span>
<span class="mi">10005</span><span class="n">A50</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">B9</span><span class="w"> </span><span class="mi">8</span><span class="n">C420610</span><span class="w">   </span><span class="n">mov</span><span class="w"> </span><span class="n">ecx</span><span class="p">,</span><span class="n">SkinCraf</span><span class="mf">.1006428</span><span class="n">C</span><span class="w">                </span><span class="p">;</span><span class="w">  </span><span class="n">DEMOSKINCRAFTERLICENCE</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
<span class="mi">10005</span><span class="n">A7A</span><span class="w">  </span><span class="o">|&gt;</span><span class="w">  </span><span class="mi">85</span><span class="n">C0</span><span class="w">          </span><span class="n">test</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="n">eax</span><span class="w"></span>
<span class="mi">10005</span><span class="n">A7C</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">75</span><span class="w"> </span><span class="mi">17</span><span class="w">         </span><span class="n">jnz</span><span class="w"> </span><span class="n">XSkinCraf</span><span class="mf">.10005</span><span class="n">A95</span><span class="w">                   </span><span class="p">;</span><span class="w">  </span><span class="n">第二次跳转判断</span><span class="w"></span>
<span class="mi">10005</span><span class="n">A7E</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">5</span><span class="n">E</span><span class="w">            </span><span class="n">pop</span><span class="w"> </span><span class="n">esi</span><span class="w"></span>
<span class="mi">10005</span><span class="n">A7F</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">B8</span><span class="w"> </span><span class="mi">01000000</span><span class="w">   </span><span class="n">mov</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="mh">0x1</span><span class="w"></span>
<span class="mi">10005</span><span class="n">A84</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">5</span><span class="n">B</span><span class="w">            </span><span class="n">pop</span><span class="w"> </span><span class="n">ebx</span><span class="w"></span>
<span class="mi">10005</span><span class="n">A85</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">8</span><span class="n">B4D</span><span class="w"> </span><span class="n">FC</span><span class="w">       </span><span class="n">mov</span><span class="w"> </span><span class="n">ecx</span><span class="p">,</span><span class="o">[</span><span class="n">local.1</span><span class="o">]</span><span class="w"></span>
<span class="mi">10005</span><span class="n">A88</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">33</span><span class="n">CD</span><span class="w">          </span><span class="n">xor</span><span class="w"> </span><span class="n">ecx</span><span class="p">,</span><span class="n">ebp</span><span class="w"></span>
<span class="mi">10005</span><span class="n">A8A</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">E8</span><span class="w"> </span><span class="n">E91E0500</span><span class="w">   </span><span class="k">call</span><span class="w"> </span><span class="n">SkinCraf</span><span class="mf">.10057978</span><span class="w"></span>
<span class="mi">10005</span><span class="n">A8F</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">8</span><span class="n">BE5</span><span class="w">          </span><span class="n">mov</span><span class="w"> </span><span class="n">esp</span><span class="p">,</span><span class="n">ebp</span><span class="w"></span>
<span class="mi">10005</span><span class="n">A91</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">5</span><span class="n">D</span><span class="w">            </span><span class="n">pop</span><span class="w"> </span><span class="n">ebp</span><span class="w"></span>
<span class="mi">10005</span><span class="n">A92</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">C2</span><span class="w"> </span><span class="mi">1000</span><span class="w">       </span><span class="n">retn</span><span class="w"> </span><span class="mh">0x10</span><span class="w"></span>
<span class="mi">10005</span><span class="n">A95</span><span class="w">  </span><span class="o">|&gt;</span><span class="w">  </span><span class="mi">6</span><span class="n">A</span><span class="w"> </span><span class="mi">00</span><span class="w">         </span><span class="n">push</span><span class="w"> </span><span class="mh">0x0</span><span class="w">                                 </span><span class="p">;</span><span class="w"> </span><span class="o">/</span><span class="n">Style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MB_OK</span><span class="o">|</span><span class="n">MB_APPLMODAL</span><span class="w"></span>
<span class="mi">10005</span><span class="n">A97</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">68</span><span class="w"> </span><span class="mi">80420610</span><span class="w">   </span><span class="n">push</span><span class="w"> </span><span class="n">SkinCraf</span><span class="mf">.10064280</span><span class="w">                   </span><span class="p">;</span><span class="w"> </span><span class="o">|</span><span class="n">SkinCrafter</span><span class="w"></span>
<span class="mi">10005</span><span class="n">A9C</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">68</span><span class="w"> </span><span class="n">D8410610</span><span class="w">   </span><span class="n">push</span><span class="w"> </span><span class="n">SkinCraf</span><span class="mf">.100641</span><span class="n">D8</span><span class="w">                   </span><span class="p">;</span><span class="w"> </span><span class="o">|</span><span class="n">You</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">DEMO</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">SkinCrafter</span><span class="p">.</span><span class="w"> </span><span class="n">InitLicenKeys</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="k">parameters</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="nl">be</span><span class="p">:</span><span class="w"> </span><span class="n">SKINCRAFTER</span><span class="p">,</span><span class="w"> </span><span class="n">SKINCRAFTER</span><span class="p">.</span><span class="n">COM</span><span class="p">,</span><span class="w"> </span><span class="n">support</span><span class="nv">@skincrafter</span><span class="p">.</span><span class="n">com</span><span class="p">,</span><span class="w"> </span><span class="n">DEMOSKINCRAFTERLICENCE</span><span class="w"></span>
<span class="mi">10005</span><span class="n">AA1</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">6</span><span class="n">A</span><span class="w"> </span><span class="mi">00</span><span class="w">         </span><span class="n">push</span><span class="w"> </span><span class="mh">0x0</span><span class="w">                                 </span><span class="p">;</span><span class="w"> </span><span class="o">|</span><span class="n">hOwner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">NULL</span><span class="w"></span>
<span class="mi">10005</span><span class="n">AA3</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">FF15</span><span class="w"> </span><span class="mi">4</span><span class="n">C350610</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ds</span><span class="p">:</span><span class="err">[</span><span class="o">&lt;&amp;</span><span class="n">USER32</span><span class="p">.</span><span class="n">MessageBoxA</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"> </span><span class="err">\</span><span class="n">MessageBoxA</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
</code></pre></div>

<h1>去除弹出框</h1>
<p>最明显的莫过于这个弹出框，程序启动后就会出现。该弹出框无边框可拖动，而且强制置顶（TOP_MOST），因此想到SetWindowPos()及SetWindowLong()两个函数，仔细查找后均无果。后来又查找了CreateWindow()、CreateRectRgn()及CreateRectRgnIndirect()也没有很好的下手位置。就在找函数这条思路没有突破口的时候，看到弹出窗口上有一条可以点击的网址，因此直接查字符串找这个网址，然后跳转到程序处。</p>
<p>找到程序处之后翻看上下文，无非就在load一些资源，突然看到ShowWindow()函数。</p>
<div class="highlight"><pre><span></span><code><span class="mf">10002</span><span class="n">F40</span>  <span class="o">/</span><span class="err">$</span>  <span class="mf">55</span>            <span class="n">push</span> <span class="n">ebp</span>
<span class="mf">10002</span><span class="n">F41</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">8</span><span class="n">BEC</span>          <span class="n">mov</span> <span class="n">ebp</span><span class="p">,</span><span class="n">esp</span>
<span class="mf">...</span>
<span class="mf">10002</span><span class="n">F87</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">68</span> <span class="n">F3000000</span>   <span class="n">push</span> <span class="mf">0</span><span class="n">xF3</span>
<span class="mf">10002</span><span class="n">F8C</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">6</span><span class="n">A</span> <span class="mf">02</span>         <span class="n">push</span> <span class="mf">0</span><span class="n">x2</span>
<span class="mf">10002</span><span class="n">F8E</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">68</span> <span class="n">F3000000</span>   <span class="n">push</span> <span class="mf">0</span><span class="n">xF3</span>
<span class="mf">10002</span><span class="n">F93</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">E8</span> <span class="n">D6410500</span>   <span class="n">call</span> <span class="o">&lt;</span><span class="n">jmp</span><span class="mf">.</span><span class="err">&amp;</span><span class="n">mfc100</span><span class="mf">.</span><span class="err">#</span><span class="n">AfxFindResourceHandle_1900</span><span class="o">&gt;</span>
<span class="mf">10002</span><span class="n">F98</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">50</span>            <span class="n">push</span> <span class="n">eax</span>                                             <span class="p">;</span> <span class="err">|</span><span class="n">hInst</span>
<span class="mf">10002</span><span class="n">F99</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">FF15</span> <span class="mf">70350610</span> <span class="n">call</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="o">&lt;</span><span class="err">&amp;</span><span class="n">USER32</span><span class="mf">.</span><span class="kr">Load</span><span class="n">BitmapW</span><span class="o">&gt;</span><span class="err">]</span>            <span class="p">;</span> <span class="err">\</span><span class="kr">Load</span><span class="n">BitmapW</span>
<span class="mf">10002</span><span class="n">F9F</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">50</span>            <span class="n">push</span> <span class="n">eax</span>
<span class="mf">10002</span><span class="n">FA0</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">B9</span> <span class="n">CC450710</span>   <span class="n">mov</span> <span class="n">ecx</span><span class="p">,</span><span class="n">SkinCraf</span><span class="mf">.100745</span><span class="n">CC</span>
<span class="mf">10002</span><span class="n">FA5</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">E8</span> <span class="n">BE410500</span>   <span class="n">call</span> <span class="o">&lt;</span><span class="n">jmp</span><span class="mf">.</span><span class="err">&amp;</span><span class="n">mfc100</span><span class="mf">.</span><span class="err">#</span><span class="n">CGdiObject</span><span class="p">::</span><span class="n">Attach_2184</span><span class="o">&gt;</span>
<span class="mf">10002</span><span class="n">FAA</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">A1</span> <span class="n">D0450710</span>   <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span><span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="mf">0</span><span class="n">x100745D0</span><span class="err">]</span>
<span class="mf">10002</span><span class="n">FAF</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">A3</span> <span class="n">D85F0710</span>   <span class="n">mov</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="mf">0</span><span class="n">x10075FD8</span><span class="err">]</span><span class="p">,</span><span class="n">eax</span>
<span class="mf">10002</span><span class="n">FB4</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">391</span><span class="n">D</span> <span class="n">DC5F0710</span> <span class="n">cmp</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="mf">0</span><span class="n">x10075FDC</span><span class="err">]</span><span class="p">,</span><span class="n">ebx</span>
<span class="mf">10002</span><span class="n">FBA</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">0</span><span class="n">F85</span> <span class="mf">7</span><span class="n">C020000</span> <span class="n">jnz</span> <span class="n">SkinCraf</span><span class="mf">.1000323</span><span class="n">C</span>
<span class="mf">...</span>
<span class="mf">10003143</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">A1</span> <span class="n">E05F0710</span>   <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span><span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="mf">0</span><span class="n">x10075FE0</span><span class="err">]</span>
<span class="mf">10003148</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">6</span><span class="n">A</span> <span class="mf">01</span>         <span class="n">push</span> <span class="mf">0</span><span class="n">x1</span>
<span class="mf">1000314</span><span class="n">A</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">51</span>            <span class="n">push</span> <span class="n">ecx</span>
<span class="mf">1000314</span><span class="n">B</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">8</span><span class="n">BCC</span>          <span class="n">mov</span> <span class="n">ecx</span><span class="p">,</span><span class="n">esp</span>
<span class="mf">1000314</span><span class="n">D</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">8965</span> <span class="n">DC</span>       <span class="n">mov</span> <span class="err">[</span><span class="n">local</span><span class="mf">.9</span><span class="err">]</span><span class="p">,</span><span class="n">esp</span>
<span class="mf">10003150</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">68</span> <span class="mf">843</span><span class="n">D0610</span>   <span class="n">push</span> <span class="n">SkinCraf</span><span class="mf">.10063</span><span class="n">D84</span>                               <span class="p">;</span>  <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="mf">.</span><span class="n">skincrafter</span><span class="mf">.</span><span class="n">com</span><span class="o">/</span><span class="ow">or</span><span class="n">der</span><span class="mf">.</span><span class="n">html</span>
<span class="mf">10003155</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">C780</span> <span class="mf">84000000</span><span class="o">&gt;</span><span class="n">mov</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="n">eax</span><span class="o">+</span><span class="mf">0</span><span class="n">x84</span><span class="err">]</span><span class="p">,</span><span class="mf">0</span><span class="n">x497D</span>
<span class="mf">1000315</span><span class="n">F</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">FF15</span> <span class="n">A4390610</span> <span class="n">call</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="o">&lt;</span><span class="err">&amp;</span><span class="n">mfc100</span><span class="mf">.</span><span class="err">#</span><span class="n">ATL</span><span class="p">::</span><span class="n">CStringT</span><span class="o">&lt;</span><span class="n">char</span><span class="p">,</span><span class="n">StrT</span><span class="o">&gt;</span><span class="p">;</span>  <span class="n">mfc100</span><span class="mf">.</span><span class="err">#</span><span class="n">ATL</span><span class="p">::</span><span class="n">CStringT</span><span class="o">&lt;</span><span class="n">char</span><span class="p">,</span><span class="n">StrTraitMFC_DLL</span><span class="o">&lt;</span><span class="n">char</span><span class="p">,</span><span class="n">ATL</span><span class="p">::</span><span class="n">ChTraitsCRT</span><span class="o">&lt;</span><span class="n">char</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">::</span><span class="n">CStringT</span><span class="o">&lt;</span><span class="n">char</span><span class="p">,</span><span class="n">StrTraitMFC_DLL</span><span class="o">&lt;</span><span class="n">char</span><span class="p">,</span><span class="n">ATL</span><span class="p">::</span><span class="n">ChTraitsCRT</span><span class="o">&lt;</span><span class="n">char</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span><span class="n">_310</span>
<span class="mf">10003165</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">8</span><span class="n">B0D</span> <span class="n">E05F0710</span> <span class="n">mov</span> <span class="n">ecx</span><span class="p">,</span><span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="mf">0</span><span class="n">x10075FE0</span><span class="err">]</span>
<span class="mf">...</span>
<span class="mf">1000323</span><span class="n">C</span>  <span class="err">|</span><span class="o">&gt;</span>  <span class="mf">8</span><span class="n">B0D</span> <span class="n">DC5F0710</span> <span class="n">mov</span> <span class="n">ecx</span><span class="p">,</span><span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="mf">0</span><span class="n">x10075FDC</span><span class="err">]</span>
<span class="mf">10003242</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">6</span><span class="n">A</span> <span class="mf">05</span>         <span class="n">push</span> <span class="mf">0</span><span class="n">x5</span>
<span class="mf">10003244</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">E8</span> <span class="mf">35410500</span>   <span class="n">call</span> <span class="o">&lt;</span><span class="n">jmp</span><span class="mf">.</span><span class="err">&amp;</span><span class="n">mfc100</span><span class="mf">.</span><span class="err">#</span><span class="n">CWnd</span><span class="p">::</span><span class="n">ShowWindow_12962</span><span class="o">&gt;</span>
<span class="mf">...</span>
</code></pre></div>

<p>可以看到，函数执行完成之后会ShowWindow()，而当参数为5的时候，就是SW_SHOW，因此可以将push的参数设置为0(SW_HIDE)或者直接把整合函数nop掉。</p>
<p><strong>2014-12-03更新：</strong></p>
<p>今天在项目上调试的时候发现又出现弹窗，使用相同的dll在皮肤测试程序上则没有出现。于是直接调试项目程序，发现还有几处ShowWindow函数。</p>
<div class="highlight"><pre><span></span><code><span class="mf">10012</span><span class="n">B40</span>  <span class="o">/</span><span class="err">$</span>  <span class="mf">55</span>            <span class="n">push</span> <span class="n">ebp</span>
<span class="mf">10012</span><span class="n">B41</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">8</span><span class="n">BEC</span>          <span class="n">mov</span> <span class="n">ebp</span><span class="p">,</span><span class="n">esp</span>
<span class="mf">10012</span><span class="n">B43</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">833</span><span class="n">D</span> <span class="n">D45F0710</span><span class="o">&gt;</span><span class="n">cmp</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="mf">0</span><span class="n">x10075FD4</span><span class="err">]</span><span class="p">,</span><span class="mf">0</span><span class="n">x0</span>
<span class="mf">10012</span><span class="n">B4A</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">56</span>            <span class="n">push</span> <span class="n">esi</span>
<span class="mf">10012</span><span class="n">B4B</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">8</span><span class="n">BF1</span>          <span class="n">mov</span> <span class="n">esi</span><span class="p">,</span><span class="n">ecx</span>
<span class="mf">10012</span><span class="n">B4D</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">75</span> <span class="mf">42</span>         <span class="n">jnz</span> <span class="n">XSkinCraf</span><span class="mf">.10012</span><span class="n">B91</span>
<span class="mf">10012</span><span class="n">B4F</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">8</span><span class="n">B0D</span> <span class="n">DC5F0710</span> <span class="n">mov</span> <span class="n">ecx</span><span class="p">,</span><span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="mf">0</span><span class="n">x10075FDC</span><span class="err">]</span>
<span class="mf">10012</span><span class="n">B55</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">6</span><span class="n">A</span> <span class="mf">05</span>         <span class="n">push</span> <span class="mf">0</span><span class="n">x5</span>
<span class="mf">10012</span><span class="n">B57</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">E8</span> <span class="mf">22480400</span>   <span class="n">call</span> <span class="o">&lt;</span><span class="n">jmp</span><span class="mf">.</span><span class="err">&amp;</span><span class="n">mfc100</span><span class="mf">.</span><span class="err">#</span><span class="n">CWnd</span><span class="p">::</span><span class="n">ShowWindow_12962</span><span class="o">&gt;</span>
<span class="mf">10012</span><span class="n">B5C</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">8</span><span class="n">B0D</span> <span class="n">DC5F0710</span> <span class="n">mov</span> <span class="n">ecx</span><span class="p">,</span><span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="mf">0</span><span class="n">x10075FDC</span><span class="err">]</span>
<span class="mf">10012</span><span class="n">B62</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">6</span><span class="n">A</span> <span class="mf">00</span>         <span class="n">push</span> <span class="mf">0</span><span class="n">x0</span>
<span class="mf">10012</span><span class="n">B64</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">6</span><span class="n">A</span> <span class="mf">08</span>         <span class="n">push</span> <span class="mf">0</span><span class="n">x8</span>
<span class="mf">10012</span><span class="n">B66</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">6</span><span class="n">A</span> <span class="mf">00</span>         <span class="n">push</span> <span class="mf">0</span><span class="n">x0</span>
<span class="mf">10012</span><span class="n">B68</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">E8</span> <span class="mf">8</span><span class="n">B490400</span>   <span class="n">call</span> <span class="o">&lt;</span><span class="n">jmp</span><span class="mf">.</span><span class="err">&amp;</span><span class="n">mfc100</span><span class="mf">.</span><span class="err">#</span><span class="n">CWnd</span><span class="p">::</span><span class="n">ModifyStyle_7889</span><span class="o">&gt;</span>
<span class="mf">10012</span><span class="n">B6D</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">8</span><span class="n">B0D</span> <span class="n">E05F0710</span> <span class="n">mov</span> <span class="n">ecx</span><span class="p">,</span><span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="mf">0</span><span class="n">x10075FE0</span><span class="err">]</span>
<span class="mf">10012</span><span class="n">B73</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">6</span><span class="n">A</span> <span class="mf">05</span>         <span class="n">push</span> <span class="mf">0</span><span class="n">x5</span>
<span class="mf">10012</span><span class="n">B75</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">E8</span> <span class="mf">04480400</span>   <span class="n">call</span> <span class="o">&lt;</span><span class="n">jmp</span><span class="mf">.</span><span class="err">&amp;</span><span class="n">mfc100</span><span class="mf">.</span><span class="err">#</span><span class="n">CWnd</span><span class="p">::</span><span class="n">ShowWindow_12962</span><span class="o">&gt;</span>
<span class="mf">10012</span><span class="n">B7A</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">8</span><span class="n">B0D</span> <span class="n">E45F0710</span> <span class="n">mov</span> <span class="n">ecx</span><span class="p">,</span><span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="mf">0</span><span class="n">x10075FE4</span><span class="err">]</span>
<span class="mf">10012</span><span class="n">B80</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">6</span><span class="n">A</span> <span class="mf">05</span>         <span class="n">push</span> <span class="mf">0</span><span class="n">x5</span>
<span class="mf">10012</span><span class="n">B82</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">E8</span> <span class="n">F7470400</span>   <span class="n">call</span> <span class="o">&lt;</span><span class="n">jmp</span><span class="mf">.</span><span class="err">&amp;</span><span class="n">mfc100</span><span class="mf">.</span><span class="err">#</span><span class="n">CWnd</span><span class="p">::</span><span class="n">ShowWindow_12962</span><span class="o">&gt;</span>
<span class="mf">10012</span><span class="n">B87</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">C705</span> <span class="n">D45F0710</span><span class="o">&gt;</span><span class="n">mov</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="mf">0</span><span class="n">x10075FD4</span><span class="err">]</span><span class="p">,</span><span class="mf">0</span><span class="n">x1</span>
<span class="mf">10012</span><span class="n">B91</span>  <span class="err">|</span><span class="o">&gt;</span>  <span class="mf">8</span><span class="n">B46</span> <span class="mf">18</span>       <span class="n">mov</span> <span class="n">eax</span><span class="p">,</span><span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="n">esi</span><span class="o">+</span><span class="mf">0</span><span class="n">x18</span><span class="err">]</span>
<span class="mf">10012</span><span class="n">B94</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">85</span><span class="n">C0</span>          <span class="n">test</span> <span class="n">eax</span><span class="p">,</span><span class="n">eax</span>
<span class="mf">10012</span><span class="n">B96</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">74</span> <span class="mf">74</span>         <span class="n">je</span> <span class="n">XSkinCraf</span><span class="mf">.10012</span><span class="n">C0C</span>
<span class="mf">...</span>
</code></pre></div>

<p>可直接在OD的Name表中找出MFC的CWnd::ShowWindow函数调用处全部下断，此处连续出现3处ShowWindow()，将第一次出现处的<code>push 0x5</code>改成<code>push 0x0</code>即可。</p>
<h1>去除标题栏DEMO字样</h1>
<p>本以为这步会很简单，很可惜，低估了作者的智商。直接找字符串没看到SkinCrafter Demo字样，因此怀疑很可能字符串是被加密的了。OD调试Dll会加载LoadDll.exe这个程序，并在Dll加载后允许通过接口执行Dll的导出函数，对于一般作为函数库的Dll这样调试当然没问题，每个函数都是独立的，但是对于这种函数之间有数据依赖的Dll来说，我必须先调用几个依赖的函数，这样就过于麻烦了（主要懒得输那么长的参数，还要小端码，而且每次加载都要输入……）。这里就用到一个技巧，自己写一个调用dll的exe，直接调试exe，并进入Dll的领空找需要的东西。</p>
<p>在OD的调试选项中，找到事件(Event)选项卡，把“中断于新模块”这项勾上，之后加载exe程序。每当exe加载一个dll的时候，就会被断下，F9继续执行，直到目标出现。当然SkinCrafterDll这个Dll是在程序中通过LoadLibrary()加载的，因此先要把程序跑起来。</p>
<p>断下后进入该Dll领空，并查看所有函数符号。考虑到和绘图有关，并经过几次实验，最后定位在GdiPlus库中的GdipDrawString()函数上，直接下断函数。但是查找函数引用的时候却没有结果，这是因为Dll刚开始并没有填充IAT，所以需要再继续F9，直到IAT初始化完毕。再查找引用就可以找到函数调用处了。</p>
<div class="highlight"><pre><span></span><code><span class="o">...</span>
<span class="mi">02</span><span class="n">E01511</span>  <span class="o">|.</span>  <span class="mi">53</span>            <span class="n">push</span> <span class="n">ebx</span>                                             <span class="o">;</span> <span class="o">/</span><span class="n">hIcon</span>
<span class="mi">02</span><span class="n">E01512</span>  <span class="o">|.</span>  <span class="n">FF15</span> <span class="mi">0034</span><span class="n">E102</span> <span class="n">call</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="o">:[&lt;&amp;</span><span class="nn">USER32</span><span class="p">.</span><span class="n">DestroyIcon</span><span class="o">&gt;]</span>            <span class="o">;</span> <span class="err">\</span><span class="n">DestroyIcon</span>
<span class="mi">02</span><span class="n">E01518</span>  <span class="o">|&gt;</span>  <span class="mi">8</span><span class="n">B9D</span> <span class="mi">54</span><span class="n">FFFFFF</span> <span class="n">mov</span> <span class="n">ebx</span><span class="o">,[</span><span class="n">local</span><span class="o">.</span><span class="mi">43</span><span class="o">]</span>
<span class="mi">02</span><span class="n">E0151E</span>  <span class="o">|&gt;</span>  <span class="n">A1</span> <span class="mi">406</span><span class="n">CE102</span>   <span class="n">mov</span> <span class="n">eax</span><span class="o">,</span><span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="o">:[</span><span class="mi">0</span><span class="n">x2E16C40</span><span class="o">]</span>
<span class="mi">02</span><span class="n">E01523</span>  <span class="o">|.</span>  <span class="mi">8</span><span class="n">B15</span> <span class="mi">3</span><span class="n">C6CE102</span> <span class="n">mov</span> <span class="n">edx</span><span class="o">,</span><span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="o">:[</span><span class="mi">0</span><span class="n">x2E16C3C</span><span class="o">]</span>
<span class="mi">02</span><span class="n">E01529</span>  <span class="o">|.</span>  <span class="mi">8</span><span class="n">B0D</span> <span class="mi">446</span><span class="n">CE102</span> <span class="n">mov</span> <span class="n">ecx</span><span class="o">,</span><span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="o">:[</span><span class="mi">0</span><span class="n">x2E16C44</span><span class="o">]</span>
<span class="mi">02</span><span class="n">E0152F</span>  <span class="o">|.</span>  <span class="mi">8945</span> <span class="n">E0</span>       <span class="n">mov</span> <span class="o">[</span><span class="n">local</span><span class="o">.</span><span class="mi">8</span><span class="o">],</span><span class="n">eax</span>
<span class="mi">02</span><span class="n">E01532</span>  <span class="o">|.</span>  <span class="mi">66</span><span class="o">:</span><span class="n">A1</span> <span class="mi">4</span><span class="n">C6CE10</span><span class="o">&gt;</span><span class="n">mov</span> <span class="n">ax</span><span class="o">,</span><span class="n">word</span> <span class="n">ptr</span> <span class="n">ds</span><span class="o">:[</span><span class="mi">0</span><span class="n">x2E16C4C</span><span class="o">]</span>
<span class="mi">02</span><span class="n">E01538</span>  <span class="o">|.</span>  <span class="mi">8955</span> <span class="n">DC</span>       <span class="n">mov</span> <span class="o">[</span><span class="n">local</span><span class="o">.</span><span class="mi">9</span><span class="o">],</span><span class="n">edx</span>
<span class="mi">02</span><span class="n">E0153B</span>  <span class="o">|.</span>  <span class="mi">8</span><span class="n">B15</span> <span class="mi">486</span><span class="n">CE102</span> <span class="n">mov</span> <span class="n">edx</span><span class="o">,</span><span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="o">:[</span><span class="mi">0</span><span class="n">x2E16C48</span><span class="o">]</span>
<span class="mi">02</span><span class="n">E01541</span>  <span class="o">|.</span>  <span class="mi">66</span><span class="o">:</span><span class="mi">8945</span> <span class="n">EC</span>    <span class="n">mov</span> <span class="n">word</span> <span class="n">ptr</span> <span class="n">ss</span><span class="o">:[</span><span class="n">ebp</span><span class="o">-</span><span class="mi">0</span><span class="n">x14</span><span class="o">],</span><span class="n">ax</span>
<span class="mi">02</span><span class="n">E01545</span>  <span class="o">|.</span>  <span class="mi">8</span><span class="n">D45</span> <span class="n">DC</span>       <span class="n">lea</span> <span class="n">eax</span><span class="o">,[</span><span class="n">local</span><span class="o">.</span><span class="mi">9</span><span class="o">]</span>
<span class="mi">02</span><span class="n">E01548</span>  <span class="o">|.</span>  <span class="mi">894</span><span class="n">D</span> <span class="n">E4</span>       <span class="n">mov</span> <span class="o">[</span><span class="n">local</span><span class="o">.</span><span class="mi">7</span><span class="o">],</span><span class="n">ecx</span>
<span class="mi">02</span><span class="n">E0154B</span>  <span class="o">|.</span>  <span class="mi">8955</span> <span class="n">E8</span>       <span class="n">mov</span> <span class="o">[</span><span class="n">local</span><span class="o">.</span><span class="mi">6</span><span class="o">],</span><span class="n">edx</span>
<span class="mi">02</span><span class="n">E0154E</span>  <span class="o">|.</span>  <span class="mi">33</span><span class="n">C9</span>          <span class="n">xor</span> <span class="n">ecx</span><span class="o">,</span><span class="n">ecx</span>
<span class="mi">02</span><span class="n">E01550</span>  <span class="o">|.</span>  <span class="mi">8</span><span class="n">D70</span> <span class="mi">01</span>       <span class="n">lea</span> <span class="n">esi</span><span class="o">,</span><span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="o">:[</span><span class="n">eax</span><span class="o">+</span><span class="mi">0</span><span class="n">x1</span><span class="o">]</span>
<span class="o">...</span>
<span class="mi">02</span><span class="n">E017E5</span>  <span class="o">|.</span>  <span class="mi">8</span><span class="n">B8D</span> <span class="mi">64</span><span class="n">FFFFFF</span> <span class="n">mov</span> <span class="n">ecx</span><span class="o">,[</span><span class="n">local</span><span class="o">.</span><span class="mi">39</span><span class="o">]</span>
<span class="mi">02</span><span class="n">E017EB</span>  <span class="o">|.</span>  <span class="mi">56</span>            <span class="n">push</span> <span class="n">esi</span>
<span class="mi">02</span><span class="n">E017EC</span>  <span class="o">|.</span>  <span class="mi">51</span>            <span class="n">push</span> <span class="n">ecx</span>
<span class="mi">02</span><span class="n">E017ED</span>  <span class="o">|.</span>  <span class="mi">8</span><span class="n">B8D</span> <span class="mi">48</span><span class="n">FFFFFF</span> <span class="n">mov</span> <span class="n">ecx</span><span class="o">,[</span><span class="n">local</span><span class="o">.</span><span class="mi">46</span><span class="o">]</span>
<span class="mi">02</span><span class="n">E017F3</span>  <span class="o">|.</span>  <span class="mi">8</span><span class="n">D95</span> <span class="n">F8FEFFFF</span> <span class="n">lea</span> <span class="n">edx</span><span class="o">,[</span><span class="n">local</span><span class="o">.</span><span class="mi">66</span><span class="o">]</span>
<span class="mi">02</span><span class="n">E017F9</span>  <span class="o">|.</span>  <span class="mi">52</span>            <span class="n">push</span> <span class="n">edx</span>
<span class="mi">02</span><span class="n">E017FA</span>  <span class="o">|.</span>  <span class="mi">8</span><span class="n">B95</span> <span class="mi">6</span><span class="n">CFFFFFF</span> <span class="n">mov</span> <span class="n">edx</span><span class="o">,[</span><span class="n">local</span><span class="o">.</span><span class="mi">37</span><span class="o">]</span>
<span class="mi">02</span><span class="n">E01800</span>  <span class="o">|.</span>  <span class="mi">51</span>            <span class="n">push</span> <span class="n">ecx</span>
<span class="mi">02</span><span class="n">E01801</span>  <span class="o">|.</span>  <span class="mi">6</span><span class="n">A</span> <span class="n">FF</span>         <span class="n">push</span> <span class="o">-</span><span class="mi">0</span><span class="n">x1</span>
<span class="mi">02</span><span class="n">E01803</span>  <span class="o">|.</span>  <span class="mi">50</span>            <span class="n">push</span> <span class="n">eax</span>
<span class="mi">02</span><span class="n">E01804</span>  <span class="o">|.</span>  <span class="mi">52</span>            <span class="n">push</span> <span class="n">edx</span>
<span class="mi">02</span><span class="n">E01805</span>  <span class="o">|.</span>  <span class="n">E8</span> <span class="n">D26D0000</span>   <span class="n">call</span> <span class="o">&lt;</span><span class="n">jmp</span><span class="o">.&amp;</span><span class="n">gdiplus</span><span class="o">.</span><span class="n">GdipDrawString</span><span class="o">&gt;</span>
<span class="mi">02</span><span class="n">E0180A</span>  <span class="o">|.</span>  <span class="mi">8</span><span class="n">B85</span> <span class="mi">64</span><span class="n">FFFFFF</span> <span class="n">mov</span> <span class="n">eax</span><span class="o">,[</span><span class="n">local</span><span class="o">.</span><span class="mi">39</span><span class="o">]</span>
<span class="mi">02</span><span class="n">E01810</span>  <span class="o">|.</span>  <span class="mi">50</span>            <span class="n">push</span> <span class="n">eax</span>
<span class="mi">02</span><span class="n">E01811</span>  <span class="o">|.</span>  <span class="n">E8</span> <span class="mi">846</span><span class="n">D0000</span>   <span class="n">call</span> <span class="o">&lt;</span><span class="n">jmp</span><span class="o">.&amp;</span><span class="n">gdiplus</span><span class="o">.</span><span class="n">GdipDeleteStringFormat</span><span class="o">&gt;</span>
<span class="mi">02</span><span class="n">E01816</span>  <span class="o">|.</span>  <span class="mi">56</span>            <span class="n">push</span> <span class="n">esi</span>
<span class="mi">02</span><span class="n">E01817</span>  <span class="o">|.</span>  <span class="n">E8</span> <span class="n">A66C0000</span>   <span class="n">call</span> <span class="o">&lt;</span><span class="n">jmp</span><span class="o">.&amp;</span><span class="n">gdiplus</span><span class="o">.</span><span class="n">GdipDeleteBrush</span><span class="o">&gt;</span>
<span class="mi">02</span><span class="n">E0181C</span>  <span class="o">|.</span>  <span class="mi">8</span><span class="n">B8D</span> <span class="mi">48</span><span class="n">FFFFFF</span> <span class="n">mov</span> <span class="n">ecx</span><span class="o">,[</span><span class="n">local</span><span class="o">.</span><span class="mi">46</span><span class="o">]</span>
<span class="mi">02</span><span class="n">E01822</span>  <span class="o">|.</span>  <span class="mi">51</span>            <span class="n">push</span> <span class="n">ecx</span>
<span class="mi">02</span><span class="n">E01823</span>  <span class="o">|.</span>  <span class="n">E8</span> <span class="mi">906</span><span class="n">D0000</span>   <span class="n">call</span> <span class="o">&lt;</span><span class="n">jmp</span><span class="o">.&amp;</span><span class="n">gdiplus</span><span class="o">.</span><span class="n">GdipDeleteFont</span><span class="o">&gt;</span>
<span class="mi">02</span><span class="n">E01828</span>  <span class="o">|.</span>  <span class="mi">8</span><span class="n">B95</span> <span class="mi">6</span><span class="n">CFFFFFF</span> <span class="n">mov</span> <span class="n">edx</span><span class="o">,[</span><span class="n">local</span><span class="o">.</span><span class="mi">37</span><span class="o">]</span>
<span class="mi">02</span><span class="n">E0182E</span>  <span class="o">|.</span>  <span class="mi">52</span>            <span class="n">push</span> <span class="n">edx</span>
<span class="mi">02</span><span class="n">E0182F</span>  <span class="o">|.</span>  <span class="n">C645</span> <span class="n">FC</span> <span class="mi">01</span>    <span class="n">mov</span> <span class="kt">byte</span> <span class="n">ptr</span> <span class="n">ss</span><span class="o">:[</span><span class="n">ebp</span><span class="o">-</span><span class="mi">0</span><span class="n">x4</span><span class="o">],</span><span class="mi">0</span><span class="n">x1</span>
<span class="mi">02</span><span class="n">E01833</span>  <span class="o">|.</span>  <span class="n">E8</span> <span class="mi">906</span><span class="n">C0000</span>   <span class="n">call</span> <span class="o">&lt;</span><span class="n">jmp</span><span class="o">.&amp;</span><span class="n">gdiplus</span><span class="o">.</span><span class="n">GdipDeleteGraphics</span><span class="o">&gt;</span>
<span class="o">...</span>
</code></pre></div>

<p>经过跟踪，可以发现字符串在DestroyIcon()执行之后被装入，在内存中显示为：</p>
<div class="highlight"><pre><span></span><code><span class="mf">02</span><span class="n">E16C38</span>  <span class="mf">80</span> <span class="mf">0</span><span class="n">F</span> <span class="n">E0</span> <span class="mf">02</span> <span class="mf">54</span> <span class="mf">6</span><span class="n">C</span> <span class="mf">6</span><span class="n">E</span> <span class="mf">69</span> <span class="mf">44</span> <span class="mf">75</span> <span class="mf">66</span> <span class="mf">61</span> <span class="mf">73</span> <span class="mf">62</span> <span class="mf">75</span> <span class="mf">27</span>  <span class="err">€?</span><span class="n">TlniDufasbu</span><span class="err">&#39;</span>
<span class="mf">02</span><span class="n">E16C48</span>  <span class="mf">43</span> <span class="mf">62</span> <span class="mf">6</span><span class="n">A</span> <span class="mf">68</span> <span class="mf">27</span> <span class="mf">00</span> <span class="mf">00</span> <span class="mf">00</span> <span class="n">E4</span> <span class="n">D9</span> <span class="n">E1</span> <span class="mf">02</span> <span class="n">A0</span> <span class="mf">2</span><span class="n">B</span> <span class="n">E0</span> <span class="mf">02</span>  <span class="n">Cbjh</span><span class="err">&#39;</span><span class="mf">...</span><span class="n">滟</span><span class="err">???</span>
</code></pre></div>

<p>因此字符串为TlniDufasbu'Cbjh'，这个字符串经过后面的算法转换成了SkinCrafter Demo，因此只要直接干掉字符串就可以，或者nop掉GdipDrawString()。我采用删掉字符串的方法，用16进制编辑器打开dll找到这个字符串并填0。</p>
<h1>后记</h1>
<p>从我使用的情况来看暂时没有出现其他问题，如果有破解不完全或造成错误的地方，我会在后续做出完善。另外，此次调试过程中全程在IDA中同步参考，IDA的图形视图能很好的看出程序的执行流程，当然IDA还有万恶的F5大杀器 :P</p>
        </section>

        <br>

        <footer>
          <!-- <div class="adjust-width">
            <div id="author-block" class="w3-light-grey w3-border">
              <div id="author-info">
                <a href=""><img style="width: 60px; height: 60px;" src="/theme/images/cat_avatar.png" onerror="this.src='theme/images/avatar.png'" alt="Avatar"></a>
                <div style="margin-left: 20px; margin-top: 15px;">
                  <a href=""><span id="author-name" class="w3-hover-text-dark-grey">YYX</span></a>
                  <p id="author-story"></p>
                </div>
              </div>
            </div>
          </div>

          <br><br><br> -->

          <p style="font-size:10pt; font-style: italic;">Did you like this article? Share it with your friends!</p>
          <div id="share" class="share">
            <a href="http://www.facebook.com/sharer.php?u=https%3A//blog.yyx.me/posts/skincrafter-crack-notes/&amp;t=YYX%27s%20Website%3A%20SkinCrafter%E7%A0%B4%E8%A7%A3%E7%AC%94%E8%AE%B0" target="_blank" class="w3-btn yyx-btn-hover">
              <i class="fa fa-facebook"></i> <!-- <span>Facebook</span> -->
            </a>
            <a href="http://twitter.com/share?url=https%3A//blog.yyx.me/posts/skincrafter-crack-notes/&amp;text=YYX%27s%20Website%3A%20SkinCrafter%E7%A0%B4%E8%A7%A3%E7%AC%94%E8%AE%B0" target="_blank" class="w3-btn yyx-btn-hover">
              <i class="fa fa-twitter"></i> <!-- <span>Twitter</span> -->
            </a>
            <a href="https://plus.google.com/share?url=https%3A//blog.yyx.me/posts/skincrafter-crack-notes/" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" class="w3-btn yyx-btn-hover">
              <i class="fa fa-google-plus"></i> <!-- <span>Google</span> -->
            </a>
          </div>

          <br><br><br>


<div id="disqus_thread" class="w3-margin-bottom"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT 
     *  THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR 
     *  PLATFORM OR CMS.
     *  
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: 
     *  https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        // Replace PAGE_URL with your page's canonical URL variable
        this.page.url = PAGE_URL;  
        
        // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        this.page.identifier = PAGE_IDENTIFIER; 
    };
    */
    
    (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document, s = d.createElement('script');
        
        // IMPORTANT: Replace EXAMPLE with your forum shortname!
        s.src = 'https://yyxblog.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>
    Please enable JavaScript to view the 
    <a href="https://disqus.com/?ref_noscript" rel="nofollow">
        comments powered by Disqus.
    </a>
</noscript>

        </footer>
      </div>
    </article>


    <footer id="footer">
      <div id="footer-copyright" class="w3-center w3-text-grey w3-padding-48">
        <span>
          &copy;
          2014&dash;2021          yyx.me
 | <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank"><i class="fa fa-creative-commons" aria-hidden="true"></i></a>        </span>
      </div>
    </footer>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-64342434-1', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
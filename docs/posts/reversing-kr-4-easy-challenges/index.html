<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>reversing.kr四道Easy题解题攻略 &ndash; YYX's Website</title>

    <!-- Meta -->
    <meta name="description" content="YYX's Website &ndash; ">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Social -->
    <meta property="article:author" content="YYX" />
    <meta property="article:section" content="Security" />
    <meta property="article:published_time" content="2014-09-10" />

    <meta property="og:type" content="article"/>
    <meta property="og:title" content="reversing.kr四道Easy题解题攻略"/>
    <meta property="og:description" content="本文为逆向工程练习网站reversing.kr中Easy Crack、Easy Keygen、Easy Unpack及Easy ELF的解题攻略。"/>
    <meta property="og:site_name" content="YYX's Website" />
    <meta property="og:url" content="https://blog.yyx.me/posts/reversing-kr-4-easy-challenges/"/>

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="reversing.kr四道Easy题解题攻略">
    <meta name="twitter:description" content="本文为逆向工程练习网站reversing.kr中Easy Crack、Easy Keygen、Easy Unpack及Easy ELF的解题攻略。">
    <meta name="twitter:url" content="https://blog.yyx.me/posts/reversing-kr-4-easy-challenges/">

    <!-- Feed -->
    <link rel="alternate" type="application/atom+xml" href="https://blog.yyx.me/feeds/all.atom.xml" title="YYX's Website Atom Feed" />
    <link rel="alternate" type="application/atom+xml" href="https://blog.yyx.me/feeds/{slug}.atom.xml" title="YYX's Website Categories Atom Feed" />
    <link rel="alternate" type="application/rss+xml" href="http://yyxblog.disqus.com/latest.rss" title="YYX's Website Comments RSS Feed">

    <!-- CSS -->
    <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:regular,bold" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://blog.yyx.me/theme/css/w3.css">
    <link rel="stylesheet" type="text/css" href="https://blog.yyx.me/theme/css/csshake.min.css">
    <link rel="stylesheet" type="text/css" href="https://blog.yyx.me/theme/css/style.css">
    <!-- <link rel="stylesheet" type="text/css" href="https://blog.yyx.me/theme/css/jqcloud.css"> -->
    <link rel="stylesheet" type="text/css" href="https://blog.yyx.me/theme/css/font-awesome.min.css">
    <!-- <link rel="stylesheet" type="text/css" href="https://blog.yyx.me/theme/css/pygments-highlight-github.css"> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow-night-eighties.min.css">

    <!-- Icon -->
    <link rel="shortcut icon" type="image/x-icon" href="/theme/images/favicon-32x32.png">

    <!-- JavaScript -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <!-- <script src="https://blog.yyx.me/theme/js/jqcloud.min.js"></script> -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="https://blog.yyx.me/theme/js/main.js"></script>
  </head>

  <body>
    <div class="w3-row w3-white">
      <header id="header">
        <a href="https://blog.yyx.me/" id="header-logo" title="Home"><img class="shake-crazy" src="https://blog.yyx.me/theme/images/logo_min.svg" width="50" height="50"></a>
        <!-- <a href="https://blog.yyx.me" id="header-logo" title="Home">Y</a> -->
        <nav id="header-menu">
          <a class="w3-bar-item w3-button w3-right w3-hide-large w3-hide-medium" id="nav-expand-btn" href="javascript:void(0)"><i class="fa fa-bars" aria-hidden="true"></i></a>
          <ul class="w3-hide-small">
            <!-- category -->
            <!-- list -->
            <!-- menu item -->
            <li class="w3-border-white w3-hover-opacity"><a href="/posts/">Posts</a></li>
            <li class="w3-border-white w3-hover-opacity"><a href="/gallery/">Gallery</a></li>
            <li class="w3-border-white w3-hover-opacity"><a href="/about/">About</a></li>
            <!-- pages -->
          </ul>
        </nav>
      </header>
    </div>



    <article class="w3-padding-64">
      <header class="w3-container col-main">
        <h1>reversing.kr四道Easy题解题攻略</h1>
        <div class="post-info">
          <div class="w3-opacity w3-margin-right w3-margin-bottom" style="flex-grow: 1;">
            <span><time datetime="2014-09-10T23:51:00-07:00">Sep 10, 2014</time> @ <a href="https://blog.yyx.me/categories/security/" title="All articles in category Security">Security</a></span>
          </div>
          <div class="w3-margin-right">
            <span class="w3-tag w3-hover-light-grey yyx-text-yellow yyx-tag-transparent">
              <a href="https://blog.yyx.me/tags/reversingkr/" title="All articles with Reversing.Kr tag">#reversing.kr</a>
            </span>
            <span class="w3-tag w3-hover-light-grey yyx-text-yellow yyx-tag-transparent">
              <a href="https://blog.yyx.me/tags/wargame/" title="All articles with Wargame tag">#wargame</a>
            </span>
            <span class="w3-tag w3-hover-light-grey yyx-text-yellow yyx-tag-transparent">
              <a href="https://blog.yyx.me/tags/hacking/" title="All articles with Hacking tag">#hacking</a>
            </span>
            <span class="w3-tag w3-hover-light-grey yyx-text-yellow yyx-tag-transparent">
              <a href="https://blog.yyx.me/tags/reversing/" title="All articles with Reversing tag">#reversing</a>
            </span>
          </div>
        </div>
      </header>


      <div class="col-main w3-container">
        <section id="content" class="w3-margin-bottom w3-padding-8">
          <h1>开篇废话</h1>
<p>Nebula的level11做的有点头大，这时大神Jack又发来了逆向的题目，让我赶紧练练。虽然我负责比赛中逆向类的题目，但逆向题一般都比较难，先放出来的题基本都是其他类别，所以我就彻底成了打（跑）辅（龙）助（套）的角色~~~</p>
<p>这次这套题目来自<a href="http://reversing.kr/">reversing.kr</a>，棒子的逆向挑战网站。话说棒子的Hacking能力还是挺强的，据说是个什么棒子的优选计划搞出来的成果。</p>
<p>本篇就记录一下4道名称是Easy开头题目，分别是Easy Crack、Easy Keygen、Easy Unpack和Easy ELF。这四题难度非常低，熟练地话掌握好节奏感可以蹭蹭蹭的秒题……</p>
<h1>Easy Crack</h1>
<p>程序启动后输入任意字符会显示一个MessageBox的Incorrect Password。打开OllyDbg，载入程序后查找到目标字符串Incorrect Password，之后转到程序，字符串前后代码如下：</p>
<div class="highlight"><pre><span></span><code><span class="mi">00401080</span><span class="w">  </span><span class="o">/</span><span class="err">$</span><span class="w">  </span><span class="mi">83</span><span class="n">EC</span><span class="w"> </span><span class="mi">64</span><span class="w">       </span><span class="n">sub</span><span class="w"> </span><span class="n">esp</span><span class="p">,</span><span class="mi">64</span><span class="w"></span>
<span class="mi">00401083</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">57</span><span class="w">            </span><span class="n">push</span><span class="w"> </span><span class="n">edi</span><span class="w"></span>
<span class="mi">00401084</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">B9</span><span class="w"> </span><span class="mi">18000000</span><span class="w">   </span><span class="n">mov</span><span class="w"> </span><span class="n">ecx</span><span class="p">,</span><span class="mi">18</span><span class="w"></span>
<span class="mi">00401089</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">33</span><span class="n">C0</span><span class="w">          </span><span class="n">xor</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="n">eax</span><span class="w"></span>
<span class="mi">0040108</span><span class="n">B</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">8</span><span class="n">D7C24</span><span class="w"> </span><span class="mi">05</span><span class="w">     </span><span class="n">lea</span><span class="w"> </span><span class="n">edi</span><span class="p">,</span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ss</span><span class="p">:</span><span class="o">[</span><span class="n">esp+5</span><span class="o">]</span><span class="w"></span>
<span class="mi">0040108</span><span class="n">F</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">C64424</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">00</span><span class="w">  </span><span class="n">mov</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ss</span><span class="p">:</span><span class="o">[</span><span class="n">esp+4</span><span class="o">]</span><span class="p">,</span><span class="mi">0</span><span class="w"></span>
<span class="mi">00401094</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">6</span><span class="n">A</span><span class="w"> </span><span class="mi">64</span><span class="w">         </span><span class="n">push</span><span class="w"> </span><span class="mi">64</span><span class="w">                                  </span><span class="p">;</span><span class="w"> </span><span class="o">/</span><span class="nf">Count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">64</span><span class="w"> </span><span class="p">(</span><span class="mf">100.</span><span class="p">)</span><span class="w"></span>
<span class="mi">00401096</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="nl">F3</span><span class="p">:</span><span class="n">AB</span><span class="w">         </span><span class="n">rep</span><span class="w"> </span><span class="n">stos</span><span class="w"> </span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">es</span><span class="p">:</span><span class="o">[</span><span class="n">edi</span><span class="o">]</span><span class="w">              </span><span class="p">;</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="mi">00401098</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">66</span><span class="err">:</span><span class="n">AB</span><span class="w">         </span><span class="n">stos</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">es</span><span class="p">:</span><span class="o">[</span><span class="n">edi</span><span class="o">]</span><span class="w">                   </span><span class="p">;</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="mi">0040109</span><span class="n">A</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">AA</span><span class="w">            </span><span class="n">stos</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">es</span><span class="p">:</span><span class="o">[</span><span class="n">edi</span><span class="o">]</span><span class="w">                   </span><span class="p">;</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="mi">0040109</span><span class="n">B</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">8</span><span class="n">B7C24</span><span class="w"> </span><span class="mi">70</span><span class="w">     </span><span class="n">mov</span><span class="w"> </span><span class="n">edi</span><span class="p">,</span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ss</span><span class="p">:</span><span class="o">[</span><span class="n">esp+70</span><span class="o">]</span><span class="w">            </span><span class="p">;</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="mi">0040109</span><span class="n">F</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">8</span><span class="n">D4424</span><span class="w"> </span><span class="mi">08</span><span class="w">     </span><span class="n">lea</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ss</span><span class="p">:</span><span class="o">[</span><span class="n">esp+8</span><span class="o">]</span><span class="w">             </span><span class="p">;</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="mi">004010</span><span class="n">A3</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">50</span><span class="w">            </span><span class="n">push</span><span class="w"> </span><span class="n">eax</span><span class="w">                                 </span><span class="p">;</span><span class="w"> </span><span class="o">|</span><span class="n">Buffer</span><span class="w"></span>
<span class="mi">004010</span><span class="n">A4</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">68</span><span class="w"> </span><span class="n">E8030000</span><span class="w">   </span><span class="n">push</span><span class="w"> </span><span class="mf">3E8</span><span class="w">                                 </span><span class="p">;</span><span class="w"> </span><span class="o">|</span><span class="n">ControlID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3E8</span><span class="w"> </span><span class="p">(</span><span class="mf">1000.</span><span class="p">)</span><span class="w"></span>
<span class="mi">004010</span><span class="n">A9</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">57</span><span class="w">            </span><span class="n">push</span><span class="w"> </span><span class="n">edi</span><span class="w">                                 </span><span class="p">;</span><span class="w"> </span><span class="o">|</span><span class="n">hWnd</span><span class="w"></span>
<span class="mi">004010</span><span class="n">AA</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">FF15</span><span class="w"> </span><span class="mi">9</span><span class="n">C504000</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ds</span><span class="p">:</span><span class="o">[</span><span class="n">&lt;&amp;USER32.GetDlgItemTe&gt;; \GetDlgItemTextA</span>

<span class="n">...</span>

<span class="n">00401114  |.  6A 40         push 40                                  ; /Style = MB_OK|MB_ICONASTERISK|MB_APPLMODAL</span>
<span class="n">00401116  |.  68 58604000   push Easy_Cra.00406058                   ; |EasyCrackMe</span>
<span class="n">0040111B  |.  68 44604000   push Easy_Cra.00406044                   ; |Congratulation !!</span>
<span class="n">00401120  |.  57            push edi                                 ; |hOwner</span>
<span class="n">00401121  |.  FF15 A0504000 call dword ptr ds:[&lt;&amp;USER32.MessageBoxA&gt;&gt;; \MessageBoxA</span>
<span class="n">00401127  |.  6A 00         push 0                                   ; /Result = 0</span>
<span class="n">00401129  |.  57            push edi                                 ; |hWnd</span>
<span class="n">0040112A  |.  FF15 A4504000 call dword ptr ds:[&lt;&amp;USER32.EndDialog&gt;</span><span class="o">]</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="err">\</span><span class="n">EndDialog</span><span class="w"></span>
<span class="mi">00401130</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">5</span><span class="n">F</span><span class="w">            </span><span class="n">pop</span><span class="w"> </span><span class="n">edi</span><span class="w"></span>
<span class="mi">00401131</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">83</span><span class="n">C4</span><span class="w"> </span><span class="mi">64</span><span class="w">       </span><span class="k">add</span><span class="w"> </span><span class="n">esp</span><span class="p">,</span><span class="mi">64</span><span class="w"></span>
<span class="mi">00401134</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">C3</span><span class="w">            </span><span class="n">retn</span><span class="w"></span>
<span class="mi">00401135</span><span class="w">  </span><span class="o">|&gt;</span><span class="w">  </span><span class="mi">6</span><span class="n">A</span><span class="w"> </span><span class="mi">10</span><span class="w">         </span><span class="n">push</span><span class="w"> </span><span class="mi">10</span><span class="w">                                  </span><span class="p">;</span><span class="w"> </span><span class="o">/</span><span class="n">Style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MB_OK</span><span class="o">|</span><span class="n">MB_ICONHAND</span><span class="o">|</span><span class="n">MB_APPLMODAL</span><span class="w"></span>
<span class="mi">00401137</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">68</span><span class="w"> </span><span class="mi">58604000</span><span class="w">   </span><span class="n">push</span><span class="w"> </span><span class="n">Easy_Cra</span><span class="mf">.00406058</span><span class="w">                   </span><span class="p">;</span><span class="w"> </span><span class="o">|</span><span class="n">EasyCrackMe</span><span class="w"></span>
<span class="mi">0040113</span><span class="n">C</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">68</span><span class="w"> </span><span class="mi">30604000</span><span class="w">   </span><span class="n">push</span><span class="w"> </span><span class="n">Easy_Cra</span><span class="mf">.00406030</span><span class="w">                   </span><span class="p">;</span><span class="w"> </span><span class="o">|</span><span class="n">Incorrect</span><span class="w"> </span><span class="n">Password</span><span class="w"></span>
<span class="mi">00401141</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">57</span><span class="w">            </span><span class="n">push</span><span class="w"> </span><span class="n">edi</span><span class="w">                                 </span><span class="p">;</span><span class="w"> </span><span class="o">|</span><span class="n">hOwner</span><span class="w"></span>
<span class="mi">00401142</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">FF15</span><span class="w"> </span><span class="n">A0504000</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ds</span><span class="p">:</span><span class="err">[</span><span class="o">&lt;&amp;</span><span class="n">USER32</span><span class="p">.</span><span class="n">MessageBoxA</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"> </span><span class="err">\</span><span class="n">MessageBoxA</span><span class="w"></span>
<span class="mi">00401148</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">5</span><span class="n">F</span><span class="w">            </span><span class="n">pop</span><span class="w"> </span><span class="n">edi</span><span class="w"></span>
<span class="mi">00401149</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">83</span><span class="n">C4</span><span class="w"> </span><span class="mi">64</span><span class="w">       </span><span class="k">add</span><span class="w"> </span><span class="n">esp</span><span class="p">,</span><span class="mi">64</span><span class="w"></span>
<span class="mi">0040114</span><span class="n">C</span><span class="w">  </span><span class="err">\</span><span class="p">.</span><span class="w">  </span><span class="n">C3</span><span class="w">            </span><span class="n">retn</span><span class="w"></span>
</code></pre></div>

<p>程序通过GetDlgItemTextA获取输入字符串，之后经过一段算法判定对错。下面分析算法：</p>
<div class="highlight"><pre><span></span><code><span class="mf">004010</span><span class="n">B0</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">807</span><span class="n">C24</span> <span class="mf">05</span> <span class="mf">61</span>  <span class="n">cmp</span> <span class="n">byte</span> <span class="n">ptr</span> <span class="n">ss</span><span class="p">:</span><span class="err">[</span><span class="n">esp</span><span class="o">+</span><span class="mf">5</span><span class="err">]</span><span class="p">,</span><span class="mf">61</span>
<span class="mf">004010</span><span class="n">B5</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">75</span> <span class="mf">7</span><span class="n">E</span>         <span class="n">jnz</span> <span class="n">short</span> <span class="n">Easy_Cra</span><span class="mf">.00401135</span>
</code></pre></div>

<p>首先确定esp+5位置字符为0x61，即a。</p>
<div class="highlight"><pre><span></span><code><span class="mf">004010</span><span class="n">B7</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">6</span><span class="n">A</span> <span class="mf">02</span>         <span class="n">push</span> <span class="mf">2</span>
<span class="mf">004010</span><span class="n">B9</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">8</span><span class="n">D4C24</span> <span class="mf">0</span><span class="n">A</span>     <span class="n">lea</span> <span class="n">ecx</span><span class="p">,</span><span class="n">dword</span> <span class="n">ptr</span> <span class="n">ss</span><span class="p">:</span><span class="err">[</span><span class="n">esp</span><span class="o">+</span><span class="n">A</span><span class="err">]</span>
<span class="mf">004010</span><span class="n">BD</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">68</span> <span class="mf">78604000</span>   <span class="n">push</span> <span class="n">Easy_Cra</span><span class="mf">.00406078</span>                   <span class="p">;</span>  <span class="mf">5</span><span class="n">y</span>
<span class="mf">004010</span><span class="n">C2</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">51</span>            <span class="n">push</span> <span class="n">ecx</span>
<span class="mf">004010</span><span class="n">C3</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">E8</span> <span class="mf">88000000</span>   <span class="n">call</span> <span class="n">Easy_Cra</span><span class="mf">.00401150</span>                   <span class="p">;</span>  <span class="n">strcmp</span>
<span class="mf">004010</span><span class="n">C8</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">83</span><span class="n">C4</span> <span class="mf">0</span><span class="n">C</span>       <span class="n">add</span> <span class="n">esp</span><span class="p">,</span><span class="mf">0</span><span class="n">C</span>
<span class="mf">004010</span><span class="n">CB</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">85</span><span class="n">C0</span>          <span class="n">test</span> <span class="n">eax</span><span class="p">,</span><span class="n">eax</span>
<span class="mf">004010</span><span class="n">CD</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">75</span> <span class="mf">66</span>         <span class="n">jnz</span> <span class="n">short</span> <span class="n">Easy_Cra</span><span class="mf">.00401135</span>
</code></pre></div>

<p>之后判断esp+A处字符串是否为5y。 这里由于<code>push 2</code>指令，栈针会上移4byte，因此此时esp=esp-4，所以现在的esp+A相当于上一次的esp-4+A（esp+6），这样就和上一次esp+5成为连续的字符串，也就是3个连续的字符为a5y。</p>
<div class="highlight"><pre><span></span><code><span class="mi">004010</span><span class="n">CF</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">53</span><span class="w">            </span><span class="n">push</span><span class="w"> </span><span class="n">ebx</span><span class="w"></span>
<span class="mi">004010</span><span class="n">D0</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">56</span><span class="w">            </span><span class="n">push</span><span class="w"> </span><span class="n">esi</span><span class="w"></span>
<span class="mi">004010</span><span class="n">D1</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">BE</span><span class="w"> </span><span class="mi">6</span><span class="n">C604000</span><span class="w">   </span><span class="n">mov</span><span class="w"> </span><span class="n">esi</span><span class="p">,</span><span class="n">Easy_Cra</span><span class="mf">.0040606</span><span class="n">C</span><span class="w">                </span><span class="p">;</span><span class="w">  </span><span class="n">R3versing</span><span class="w"></span>
<span class="mi">004010</span><span class="n">D6</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">8</span><span class="n">D4424</span><span class="w"> </span><span class="mi">10</span><span class="w">     </span><span class="n">lea</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ss</span><span class="p">:</span><span class="o">[</span><span class="n">esp+10</span><span class="o">]</span><span class="w"></span>
<span class="mi">004010</span><span class="n">DA</span><span class="w">  </span><span class="o">|&gt;</span><span class="w">  </span><span class="mi">8</span><span class="n">A10</span><span class="w">          </span><span class="o">/</span><span class="n">mov</span><span class="w"> </span><span class="n">dl</span><span class="p">,</span><span class="n">byte</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ds</span><span class="p">:</span><span class="o">[</span><span class="n">eax</span><span class="o">]</span><span class="w"></span>
<span class="mi">004010</span><span class="n">DC</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">8</span><span class="n">A1E</span><span class="w">          </span><span class="o">|</span><span class="n">mov</span><span class="w"> </span><span class="n">bl</span><span class="p">,</span><span class="n">byte</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ds</span><span class="p">:</span><span class="o">[</span><span class="n">esi</span><span class="o">]</span><span class="w"></span>
<span class="mi">004010</span><span class="n">DE</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">8</span><span class="n">ACA</span><span class="w">          </span><span class="o">|</span><span class="n">mov</span><span class="w"> </span><span class="n">cl</span><span class="p">,</span><span class="n">dl</span><span class="w"></span>
<span class="mf">004010E0</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">3</span><span class="n">AD3</span><span class="w">          </span><span class="o">|</span><span class="n">cmp</span><span class="w"> </span><span class="n">dl</span><span class="p">,</span><span class="n">bl</span><span class="w"></span>
<span class="mf">004010E2</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">75</span><span class="w"> </span><span class="mi">1</span><span class="n">E</span><span class="w">         </span><span class="o">|</span><span class="n">jnz</span><span class="w"> </span><span class="n">short</span><span class="w"> </span><span class="n">Easy_Cra</span><span class="mf">.00401102</span><span class="w"></span>
<span class="mf">004010E4</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">84</span><span class="n">C9</span><span class="w">          </span><span class="o">|</span><span class="n">test</span><span class="w"> </span><span class="n">cl</span><span class="p">,</span><span class="n">cl</span><span class="w"></span>
<span class="mf">004010E6</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">74</span><span class="w"> </span><span class="mi">16</span><span class="w">         </span><span class="o">|</span><span class="n">je</span><span class="w"> </span><span class="n">short</span><span class="w"> </span><span class="n">Easy_Cra</span><span class="mf">.004010</span><span class="n">FE</span><span class="w"></span>
<span class="mf">004010E8</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">8</span><span class="n">A50</span><span class="w"> </span><span class="mi">01</span><span class="w">       </span><span class="o">|</span><span class="n">mov</span><span class="w"> </span><span class="n">dl</span><span class="p">,</span><span class="n">byte</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ds</span><span class="p">:</span><span class="o">[</span><span class="n">eax+1</span><span class="o">]</span><span class="w"></span>
<span class="mi">004010</span><span class="n">EB</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">8</span><span class="n">A5E</span><span class="w"> </span><span class="mi">01</span><span class="w">       </span><span class="o">|</span><span class="n">mov</span><span class="w"> </span><span class="n">bl</span><span class="p">,</span><span class="n">byte</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ds</span><span class="p">:</span><span class="o">[</span><span class="n">esi+1</span><span class="o">]</span><span class="w"></span>
<span class="mi">004010</span><span class="n">EE</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">8</span><span class="n">ACA</span><span class="w">          </span><span class="o">|</span><span class="n">mov</span><span class="w"> </span><span class="n">cl</span><span class="p">,</span><span class="n">dl</span><span class="w"></span>
<span class="mi">004010</span><span class="n">F0</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">3</span><span class="n">AD3</span><span class="w">          </span><span class="o">|</span><span class="n">cmp</span><span class="w"> </span><span class="n">dl</span><span class="p">,</span><span class="n">bl</span><span class="w"></span>
<span class="mi">004010</span><span class="n">F2</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">75</span><span class="w"> </span><span class="mi">0</span><span class="n">E</span><span class="w">         </span><span class="o">|</span><span class="n">jnz</span><span class="w"> </span><span class="n">short</span><span class="w"> </span><span class="n">Easy_Cra</span><span class="mf">.00401102</span><span class="w"></span>
<span class="mi">004010</span><span class="n">F4</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">83</span><span class="n">C0</span><span class="w"> </span><span class="mi">02</span><span class="w">       </span><span class="o">|</span><span class="k">add</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="mi">2</span><span class="w"></span>
<span class="mi">004010</span><span class="n">F7</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">83</span><span class="n">C6</span><span class="w"> </span><span class="mi">02</span><span class="w">       </span><span class="o">|</span><span class="k">add</span><span class="w"> </span><span class="n">esi</span><span class="p">,</span><span class="mi">2</span><span class="w"></span>
<span class="mi">004010</span><span class="n">FA</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">84</span><span class="n">C9</span><span class="w">          </span><span class="o">|</span><span class="n">test</span><span class="w"> </span><span class="n">cl</span><span class="p">,</span><span class="n">cl</span><span class="w"></span>
<span class="mi">004010</span><span class="n">FC</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="o">^</span><span class="w"> </span><span class="mi">75</span><span class="w"> </span><span class="n">DC</span><span class="w">         </span><span class="err">\</span><span class="n">jnz</span><span class="w"> </span><span class="n">short</span><span class="w"> </span><span class="n">Easy_Cra</span><span class="mf">.004010</span><span class="n">DA</span><span class="w"></span>
<span class="mi">004010</span><span class="n">FE</span><span class="w">  </span><span class="o">|&gt;</span><span class="w">  </span><span class="mi">33</span><span class="n">C0</span><span class="w">          </span><span class="n">xor</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="n">eax</span><span class="w"></span>
<span class="mi">00401100</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">EB</span><span class="w"> </span><span class="mi">05</span><span class="w">         </span><span class="n">jmp</span><span class="w"> </span><span class="n">short</span><span class="w"> </span><span class="n">Easy_Cra</span><span class="mf">.00401107</span><span class="w"></span>
<span class="mi">00401102</span><span class="w">  </span><span class="o">|&gt;</span><span class="w">  </span><span class="mi">1</span><span class="n">BC0</span><span class="w">          </span><span class="n">sbb</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="n">eax</span><span class="w"></span>
<span class="mi">00401104</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">83</span><span class="n">D8</span><span class="w"> </span><span class="n">FF</span><span class="w">       </span><span class="n">sbb</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="mi">00401107</span><span class="w">  </span><span class="o">|&gt;</span><span class="w">  </span><span class="mi">5</span><span class="n">E</span><span class="w">            </span><span class="n">pop</span><span class="w"> </span><span class="n">esi</span><span class="w"></span>
<span class="mi">00401108</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">5</span><span class="n">B</span><span class="w">            </span><span class="n">pop</span><span class="w"> </span><span class="n">ebx</span><span class="w"></span>
<span class="mi">00401109</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">85</span><span class="n">C0</span><span class="w">          </span><span class="n">test</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="n">eax</span><span class="w"></span>
<span class="mi">0040110</span><span class="n">B</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">75</span><span class="w"> </span><span class="mi">28</span><span class="w">         </span><span class="n">jnz</span><span class="w"> </span><span class="n">short</span><span class="w"> </span><span class="n">Easy_Cra</span><span class="mf">.00401135</span><span class="w"></span>
<span class="mi">0040110</span><span class="n">D</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">807</span><span class="n">C24</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">45</span><span class="w">  </span><span class="n">cmp</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ss</span><span class="p">:</span><span class="o">[</span><span class="n">esp+4</span><span class="o">]</span><span class="p">,</span><span class="mi">45</span><span class="w"></span>
<span class="mi">00401112</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">75</span><span class="w"> </span><span class="mi">21</span><span class="w">         </span><span class="n">jnz</span><span class="w"> </span><span class="n">short</span><span class="w"> </span><span class="n">Easy_Cra</span><span class="mf">.00401135</span><span class="w"></span>
</code></pre></div>

<p>之后匹配字符串R3versing，并在字符串头部（esp+4处）添加字符为E。因此答案为Ea5yR3versing。</p>
<p>这里算法由于涉及到esp的改变，因此OD跟踪起来比IDA静态分析更加简单。可以直接将程序跑起来，当程序碰到相关判断的地方（一般是cmp）会改变标志位（一般是ZF），只需要改变标志位寄存器的值让它按照你要的逻辑执行下去即可，当然你需要同时记录这些让逻辑保持正确的字符，你可以直接在栈（或数据区）中作出修改。之后当程序跑完之后，你的栈（或数据区）中就是一个正确的值。本程序栈的结构如下：</p>
<p><img alt="OD" src="/statics/reversing-kr-4-easy-challenges/2014-09-13_234947.jpg"></p>
<h1>Easy Keygen</h1>
<p>注册机题，readme要求Find the Name when the Serial is 5B134977135E7D13。程序跑起来，要求输入名字和序列号，测试了一下Name为abcde和随机的序列号，提示错误：</p>
<div class="highlight"><pre><span></span><code>C:\Users\GreatYYX&gt;&quot;F:\Crack\reversingkr\Easy_KeygenMe\Easy Keygen.exe&quot;

Input Name: abcde
Input Serial: 12345
Wrong
</code></pre></div>

<p>开OD跟着跑一下，下断点在InputName和InputSerial处，可以看到判定对错函数如下：</p>
<div class="highlight"><pre><span></span><code><span class="mi">00401000</span><span class="w">  </span><span class="o">/</span><span class="err">$</span><span class="w">  </span><span class="mi">81</span><span class="n">EC</span><span class="w"> </span><span class="mi">30010000</span><span class="w"> </span><span class="n">sub</span><span class="w"> </span><span class="n">esp</span><span class="p">,</span><span class="mi">130</span><span class="w"></span>
<span class="mi">00401006</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">55</span><span class="w">            </span><span class="n">push</span><span class="w"> </span><span class="n">ebp</span><span class="w"></span>
<span class="mi">00401007</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">56</span><span class="w">            </span><span class="n">push</span><span class="w"> </span><span class="n">esi</span><span class="w"></span>
<span class="mi">00401008</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">57</span><span class="w">            </span><span class="n">push</span><span class="w"> </span><span class="n">edi</span><span class="w"></span>
<span class="mi">00401009</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">B9</span><span class="w"> </span><span class="mi">18000000</span><span class="w">   </span><span class="n">mov</span><span class="w"> </span><span class="n">ecx</span><span class="p">,</span><span class="mi">18</span><span class="w"></span>
<span class="mi">0040100</span><span class="n">E</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">33</span><span class="n">C0</span><span class="w">          </span><span class="n">xor</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="n">eax</span><span class="w"></span>
<span class="mi">00401010</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">8</span><span class="n">D7C24</span><span class="w"> </span><span class="mi">11</span><span class="w">     </span><span class="n">lea</span><span class="w"> </span><span class="n">edi</span><span class="p">,</span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ss</span><span class="p">:</span><span class="o">[</span><span class="n">esp+11</span><span class="o">]</span><span class="w"></span>
<span class="mi">00401014</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">C64424</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="mi">00</span><span class="w">  </span><span class="n">mov</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ss</span><span class="p">:</span><span class="o">[</span><span class="n">esp+10</span><span class="o">]</span><span class="p">,</span><span class="mi">0</span><span class="w"></span>
<span class="mi">00401019</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">C64424</span><span class="w"> </span><span class="mi">74</span><span class="w"> </span><span class="mi">00</span><span class="w">  </span><span class="n">mov</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ss</span><span class="p">:</span><span class="o">[</span><span class="n">esp+74</span><span class="o">]</span><span class="p">,</span><span class="mi">0</span><span class="w"></span>
<span class="mi">0040101</span><span class="n">E</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="nl">F3</span><span class="p">:</span><span class="n">AB</span><span class="w">         </span><span class="n">rep</span><span class="w"> </span><span class="n">stos</span><span class="w"> </span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">es</span><span class="p">:</span><span class="o">[</span><span class="n">edi</span><span class="o">]</span><span class="w"></span>
<span class="mi">00401020</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">66</span><span class="err">:</span><span class="n">AB</span><span class="w">         </span><span class="n">stos</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">es</span><span class="p">:</span><span class="o">[</span><span class="n">edi</span><span class="o">]</span><span class="w"></span>
<span class="mi">00401022</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">AA</span><span class="w">            </span><span class="n">stos</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">es</span><span class="p">:</span><span class="o">[</span><span class="n">edi</span><span class="o">]</span><span class="w"></span>
<span class="mi">00401023</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">B9</span><span class="w"> </span><span class="mi">31000000</span><span class="w">   </span><span class="n">mov</span><span class="w"> </span><span class="n">ecx</span><span class="p">,</span><span class="mi">31</span><span class="w"></span>
<span class="mi">00401028</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">33</span><span class="n">C0</span><span class="w">          </span><span class="n">xor</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="n">eax</span><span class="w"></span>
<span class="mi">0040102</span><span class="n">A</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">8</span><span class="n">D7C24</span><span class="w"> </span><span class="mi">75</span><span class="w">     </span><span class="n">lea</span><span class="w"> </span><span class="n">edi</span><span class="p">,</span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ss</span><span class="p">:</span><span class="o">[</span><span class="n">esp+75</span><span class="o">]</span><span class="w"></span>
<span class="mi">0040102</span><span class="n">E</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">68</span><span class="w"> </span><span class="mi">60804000</span><span class="w">   </span><span class="n">push</span><span class="w"> </span><span class="n">Easy_Key</span><span class="mf">.00408060</span><span class="w">                   </span><span class="p">;</span><span class="w">  </span><span class="k">Input</span><span class="w"> </span><span class="nl">Name</span><span class="p">:</span><span class="w"></span>
<span class="mi">00401033</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="nl">F3</span><span class="p">:</span><span class="n">AB</span><span class="w">         </span><span class="n">rep</span><span class="w"> </span><span class="n">stos</span><span class="w"> </span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">es</span><span class="p">:</span><span class="o">[</span><span class="n">edi</span><span class="o">]</span><span class="w"></span>
<span class="mi">00401035</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">66</span><span class="err">:</span><span class="n">AB</span><span class="w">         </span><span class="n">stos</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">es</span><span class="p">:</span><span class="o">[</span><span class="n">edi</span><span class="o">]</span><span class="w"></span>
<span class="mi">00401037</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">AA</span><span class="w">            </span><span class="n">stos</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">es</span><span class="p">:</span><span class="o">[</span><span class="n">edi</span><span class="o">]</span><span class="w"></span>
<span class="mi">00401038</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">C64424</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="mi">10</span><span class="w">  </span><span class="n">mov</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ss</span><span class="p">:</span><span class="o">[</span><span class="n">esp+10</span><span class="o">]</span><span class="p">,</span><span class="mi">10</span><span class="w">              </span><span class="p">;</span><span class="w">  </span><span class="k">array</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">bytes</span><span class="w"></span>
<span class="mi">0040103</span><span class="n">D</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">C64424</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="mi">20</span><span class="w">  </span><span class="n">mov</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ss</span><span class="p">:</span><span class="o">[</span><span class="n">esp+11</span><span class="o">]</span><span class="p">,</span><span class="mi">20</span><span class="w"></span>
<span class="mi">00401042</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">C64424</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="mi">30</span><span class="w">  </span><span class="n">mov</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ss</span><span class="p">:</span><span class="o">[</span><span class="n">esp+12</span><span class="o">]</span><span class="p">,</span><span class="mi">30</span><span class="w"></span>
<span class="mi">00401047</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">E8</span><span class="w"> </span><span class="mi">6</span><span class="n">D010000</span><span class="w">   </span><span class="k">call</span><span class="w"> </span><span class="n">Easy_Key</span><span class="mf">.004011</span><span class="n">B9</span><span class="w"></span>
<span class="mi">0040104</span><span class="n">C</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">83</span><span class="n">C4</span><span class="w"> </span><span class="mi">04</span><span class="w">       </span><span class="k">add</span><span class="w"> </span><span class="n">esp</span><span class="p">,</span><span class="mi">4</span><span class="w"></span>
<span class="mi">0040104</span><span class="n">F</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">8</span><span class="n">D4424</span><span class="w"> </span><span class="mi">10</span><span class="w">     </span><span class="n">lea</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ss</span><span class="p">:</span><span class="o">[</span><span class="n">esp+10</span><span class="o">]</span><span class="w"></span>
<span class="mi">00401053</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">50</span><span class="w">            </span><span class="n">push</span><span class="w"> </span><span class="n">eax</span><span class="w"></span>
<span class="mi">00401054</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">68</span><span class="w"> </span><span class="mi">5</span><span class="n">C804000</span><span class="w">   </span><span class="n">push</span><span class="w"> </span><span class="n">Easy_Key</span><span class="mf">.0040805</span><span class="n">C</span><span class="w">                   </span><span class="p">;</span><span class="w">  </span><span class="o">%</span><span class="n">s</span><span class="w"></span>
<span class="mi">00401059</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">E8</span><span class="w"> </span><span class="mi">44010000</span><span class="w">   </span><span class="k">call</span><span class="w"> </span><span class="n">Easy_Key</span><span class="mf">.004011</span><span class="n">A2</span><span class="w">                   </span><span class="p">;</span><span class="w">  </span><span class="k">input</span><span class="w"> </span><span class="k">function</span><span class="w"></span>
<span class="mi">0040105</span><span class="n">E</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">8</span><span class="n">D7C24</span><span class="w"> </span><span class="mi">18</span><span class="w">     </span><span class="n">lea</span><span class="w"> </span><span class="n">edi</span><span class="p">,</span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ss</span><span class="p">:</span><span class="o">[</span><span class="n">esp+18</span><span class="o">]</span><span class="w"></span>
<span class="mi">00401062</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">83</span><span class="n">C9</span><span class="w"> </span><span class="n">FF</span><span class="w">       </span><span class="ow">or</span><span class="w"> </span><span class="n">ecx</span><span class="p">,</span><span class="n">FFFFFFFF</span><span class="w"></span>
<span class="mi">00401065</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">33</span><span class="n">C0</span><span class="w">          </span><span class="n">xor</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="n">eax</span><span class="w"></span>
<span class="mi">00401067</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">83</span><span class="n">C4</span><span class="w"> </span><span class="mi">08</span><span class="w">       </span><span class="k">add</span><span class="w"> </span><span class="n">esp</span><span class="p">,</span><span class="mi">8</span><span class="w"></span>
<span class="mi">0040106</span><span class="n">A</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">33</span><span class="n">ED</span><span class="w">          </span><span class="n">xor</span><span class="w"> </span><span class="n">ebp</span><span class="p">,</span><span class="n">ebp</span><span class="w"></span>
<span class="mi">0040106</span><span class="n">C</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">33</span><span class="n">F6</span><span class="w">          </span><span class="n">xor</span><span class="w"> </span><span class="n">esi</span><span class="p">,</span><span class="n">esi</span><span class="w"></span>
<span class="mi">0040106</span><span class="n">E</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="nl">F2</span><span class="p">:</span><span class="n">AE</span><span class="w">         </span><span class="n">repne</span><span class="w"> </span><span class="n">scas</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">es</span><span class="p">:</span><span class="o">[</span><span class="n">edi</span><span class="o">]</span><span class="w"></span>
<span class="mi">00401070</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">F7D1</span><span class="w">          </span><span class="ow">not</span><span class="w"> </span><span class="n">ecx</span><span class="w"></span>
<span class="mi">00401072</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">49</span><span class="w">            </span><span class="k">dec</span><span class="w"> </span><span class="n">ecx</span><span class="w"></span>
<span class="mi">00401073</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">85</span><span class="n">C9</span><span class="w">          </span><span class="n">test</span><span class="w"> </span><span class="n">ecx</span><span class="p">,</span><span class="n">ecx</span><span class="w"></span>
<span class="mi">00401075</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">7</span><span class="n">E</span><span class="w"> </span><span class="mi">3</span><span class="n">F</span><span class="w">         </span><span class="n">jle</span><span class="w"> </span><span class="n">short</span><span class="w"> </span><span class="n">Easy_Key</span><span class="mf">.004010</span><span class="n">B6</span><span class="w"></span>
<span class="mi">00401077</span><span class="w">  </span><span class="o">|&gt;</span><span class="w">  </span><span class="mi">83</span><span class="n">FE</span><span class="w"> </span><span class="mi">03</span><span class="w">       </span><span class="o">/</span><span class="n">cmp</span><span class="w"> </span><span class="n">esi</span><span class="p">,</span><span class="mi">3</span><span class="w"></span>
<span class="mi">0040107</span><span class="n">A</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">7</span><span class="n">C</span><span class="w"> </span><span class="mi">02</span><span class="w">         </span><span class="o">|</span><span class="n">jl</span><span class="w"> </span><span class="n">short</span><span class="w"> </span><span class="n">Easy_Key</span><span class="mf">.0040107</span><span class="n">E</span><span class="w"></span>
<span class="mi">0040107</span><span class="n">C</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">33</span><span class="n">F6</span><span class="w">          </span><span class="o">|</span><span class="n">xor</span><span class="w"> </span><span class="n">esi</span><span class="p">,</span><span class="n">esi</span><span class="w"></span>
<span class="mi">0040107</span><span class="n">E</span><span class="w">  </span><span class="o">|&gt;</span><span class="w">  </span><span class="mi">0</span><span class="n">FBE4C34</span><span class="w"> </span><span class="mi">0</span><span class="n">C</span><span class="w">   </span><span class="o">|</span><span class="n">movsx</span><span class="w"> </span><span class="n">ecx</span><span class="p">,</span><span class="n">byte</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ss</span><span class="p">:</span><span class="o">[</span><span class="n">esp+esi+C</span><span class="o">]</span><span class="w"></span>
<span class="mi">00401083</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">0</span><span class="n">FBE542C</span><span class="w"> </span><span class="mi">10</span><span class="w">   </span><span class="o">|</span><span class="n">movsx</span><span class="w"> </span><span class="n">edx</span><span class="p">,</span><span class="n">byte</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ss</span><span class="p">:</span><span class="o">[</span><span class="n">esp+ebp+10</span><span class="o">]</span><span class="w"></span>
<span class="mi">00401088</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">33</span><span class="n">CA</span><span class="w">          </span><span class="o">|</span><span class="n">xor</span><span class="w"> </span><span class="n">ecx</span><span class="p">,</span><span class="n">edx</span><span class="w"></span>
<span class="mi">0040108</span><span class="n">A</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">8</span><span class="n">D4424</span><span class="w"> </span><span class="mi">74</span><span class="w">     </span><span class="o">|</span><span class="n">lea</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ss</span><span class="p">:</span><span class="o">[</span><span class="n">esp+74</span><span class="o">]</span><span class="w"></span>
<span class="mi">0040108</span><span class="n">E</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">51</span><span class="w">            </span><span class="o">|</span><span class="n">push</span><span class="w"> </span><span class="n">ecx</span><span class="w"></span>
<span class="mi">0040108</span><span class="n">F</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">50</span><span class="w">            </span><span class="o">|</span><span class="n">push</span><span class="w"> </span><span class="n">eax</span><span class="w"></span>
<span class="mi">00401090</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">8</span><span class="n">D4C24</span><span class="w"> </span><span class="mi">7</span><span class="n">C</span><span class="w">     </span><span class="o">|</span><span class="n">lea</span><span class="w"> </span><span class="n">ecx</span><span class="p">,</span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ss</span><span class="p">:</span><span class="o">[</span><span class="n">esp+7C</span><span class="o">]</span><span class="w"></span>
<span class="mi">00401094</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">68</span><span class="w"> </span><span class="mi">54804000</span><span class="w">   </span><span class="o">|</span><span class="n">push</span><span class="w"> </span><span class="n">Easy_Key</span><span class="mf">.00408054</span><span class="w">                  </span><span class="p">;</span><span class="w">  </span><span class="o">%</span><span class="n">s</span><span class="o">%</span><span class="mi">02</span><span class="n">X</span><span class="w"></span>
<span class="mi">00401099</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">51</span><span class="w">            </span><span class="o">|</span><span class="n">push</span><span class="w"> </span><span class="n">ecx</span><span class="w"></span>
<span class="mi">0040109</span><span class="n">A</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">E8</span><span class="w"> </span><span class="n">B1000000</span><span class="w">   </span><span class="o">|</span><span class="k">call</span><span class="w"> </span><span class="n">Easy_Key</span><span class="mf">.00401150</span><span class="w"></span>
<span class="mi">0040109</span><span class="n">F</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">83</span><span class="n">C4</span><span class="w"> </span><span class="mi">10</span><span class="w">       </span><span class="o">|</span><span class="k">add</span><span class="w"> </span><span class="n">esp</span><span class="p">,</span><span class="mi">10</span><span class="w"></span>
<span class="mi">004010</span><span class="n">A2</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">45</span><span class="w">            </span><span class="o">|</span><span class="n">inc</span><span class="w"> </span><span class="n">ebp</span><span class="w"></span>
<span class="mi">004010</span><span class="n">A3</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">8</span><span class="n">D7C24</span><span class="w"> </span><span class="mi">10</span><span class="w">     </span><span class="o">|</span><span class="n">lea</span><span class="w"> </span><span class="n">edi</span><span class="p">,</span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ss</span><span class="p">:</span><span class="o">[</span><span class="n">esp+10</span><span class="o">]</span><span class="w"></span>
<span class="mi">004010</span><span class="n">A7</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">83</span><span class="n">C9</span><span class="w"> </span><span class="n">FF</span><span class="w">       </span><span class="o">|</span><span class="ow">or</span><span class="w"> </span><span class="n">ecx</span><span class="p">,</span><span class="n">FFFFFFFF</span><span class="w"></span>
<span class="mi">004010</span><span class="n">AA</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">33</span><span class="n">C0</span><span class="w">          </span><span class="o">|</span><span class="n">xor</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="n">eax</span><span class="w"></span>
<span class="mi">004010</span><span class="n">AC</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">46</span><span class="w">            </span><span class="o">|</span><span class="n">inc</span><span class="w"> </span><span class="n">esi</span><span class="w"></span>
<span class="mi">004010</span><span class="n">AD</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="nl">F2</span><span class="p">:</span><span class="n">AE</span><span class="w">         </span><span class="o">|</span><span class="n">repne</span><span class="w"> </span><span class="n">scas</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">es</span><span class="p">:</span><span class="o">[</span><span class="n">edi</span><span class="o">]</span><span class="w"></span>
<span class="mi">004010</span><span class="n">AF</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">F7D1</span><span class="w">          </span><span class="o">|</span><span class="ow">not</span><span class="w"> </span><span class="n">ecx</span><span class="w"></span>
<span class="mi">004010</span><span class="n">B1</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">49</span><span class="w">            </span><span class="o">|</span><span class="k">dec</span><span class="w"> </span><span class="n">ecx</span><span class="w"></span>
<span class="mi">004010</span><span class="n">B2</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">3</span><span class="n">BE9</span><span class="w">          </span><span class="o">|</span><span class="n">cmp</span><span class="w"> </span><span class="n">ebp</span><span class="p">,</span><span class="n">ecx</span><span class="w"></span>
<span class="mi">004010</span><span class="n">B4</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="o">^</span><span class="w"> </span><span class="mi">7</span><span class="n">C</span><span class="w"> </span><span class="n">C1</span><span class="w">         </span><span class="err">\</span><span class="n">jl</span><span class="w"> </span><span class="n">short</span><span class="w"> </span><span class="n">Easy_Key</span><span class="mf">.00401077</span><span class="w"></span>
<span class="mi">004010</span><span class="n">B6</span><span class="w">  </span><span class="o">|&gt;</span><span class="w">  </span><span class="n">B9</span><span class="w"> </span><span class="mi">19000000</span><span class="w">   </span><span class="n">mov</span><span class="w"> </span><span class="n">ecx</span><span class="p">,</span><span class="mi">19</span><span class="w"></span>
<span class="mi">004010</span><span class="n">BB</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">33</span><span class="n">C0</span><span class="w">          </span><span class="n">xor</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="n">eax</span><span class="w"></span>
<span class="mi">004010</span><span class="n">BD</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">8</span><span class="n">D7C24</span><span class="w"> </span><span class="mi">10</span><span class="w">     </span><span class="n">lea</span><span class="w"> </span><span class="n">edi</span><span class="p">,</span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ss</span><span class="p">:</span><span class="o">[</span><span class="n">esp+10</span><span class="o">]</span><span class="w"></span>
<span class="mi">004010</span><span class="n">C1</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">68</span><span class="w"> </span><span class="mi">44804000</span><span class="w">   </span><span class="n">push</span><span class="w"> </span><span class="n">Easy_Key</span><span class="mf">.00408044</span><span class="w">                   </span><span class="p">;</span><span class="w">  </span><span class="k">Input</span><span class="w"> </span><span class="nl">Serial</span><span class="p">:</span><span class="w"></span>
<span class="mi">004010</span><span class="n">C6</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="nl">F3</span><span class="p">:</span><span class="n">AB</span><span class="w">         </span><span class="n">rep</span><span class="w"> </span><span class="n">stos</span><span class="w"> </span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">es</span><span class="p">:</span><span class="o">[</span><span class="n">edi</span><span class="o">]</span><span class="w"></span>

<span class="p">...</span><span class="w"></span>

<span class="mi">0040111</span><span class="n">A</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">68</span><span class="w"> </span><span class="mi">38804000</span><span class="w">   </span><span class="n">push</span><span class="w"> </span><span class="n">Easy_Key</span><span class="mf">.00408038</span><span class="w">                   </span><span class="p">;</span><span class="w">  </span><span class="n">Correct</span><span class="err">!\</span><span class="n">n</span><span class="w"></span>
<span class="mi">0040111</span><span class="n">F</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">E8</span><span class="w"> </span><span class="mi">95000000</span><span class="w">   </span><span class="k">call</span><span class="w"> </span><span class="n">Easy_Key</span><span class="mf">.004011</span><span class="n">B9</span><span class="w"></span>
<span class="mi">00401124</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">83</span><span class="n">C4</span><span class="w"> </span><span class="mi">04</span><span class="w">       </span><span class="k">add</span><span class="w"> </span><span class="n">esp</span><span class="p">,</span><span class="mi">4</span><span class="w"></span>
<span class="mi">00401127</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">33</span><span class="n">C0</span><span class="w">          </span><span class="n">xor</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="n">eax</span><span class="w"></span>
<span class="mi">00401129</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">81</span><span class="n">C4</span><span class="w"> </span><span class="mi">30010000</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="n">esp</span><span class="p">,</span><span class="mi">130</span><span class="w"></span>
<span class="mi">0040112</span><span class="n">F</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">C3</span><span class="w">            </span><span class="n">retn</span><span class="w"></span>
<span class="mi">00401130</span><span class="w">  </span><span class="o">|&gt;</span><span class="w">  </span><span class="mi">68</span><span class="w"> </span><span class="mi">30804000</span><span class="w">   </span><span class="n">push</span><span class="w"> </span><span class="n">Easy_Key</span><span class="mf">.00408030</span><span class="w">                   </span><span class="p">;</span><span class="w">  </span><span class="n">Wrong</span><span class="err">\</span><span class="n">n</span><span class="w"></span>
<span class="mi">00401135</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="n">E8</span><span class="w"> </span><span class="mi">7</span><span class="n">F000000</span><span class="w">   </span><span class="k">call</span><span class="w"> </span><span class="n">Easy_Key</span><span class="mf">.004011</span><span class="n">B9</span><span class="w"></span>
<span class="mi">0040113</span><span class="n">A</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">83</span><span class="n">C4</span><span class="w"> </span><span class="mi">04</span><span class="w">       </span><span class="k">add</span><span class="w"> </span><span class="n">esp</span><span class="p">,</span><span class="mi">4</span><span class="w"></span>
<span class="mi">0040113</span><span class="n">D</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">33</span><span class="n">C0</span><span class="w">          </span><span class="n">xor</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="n">eax</span><span class="w"></span>
<span class="mi">0040113</span><span class="n">F</span><span class="w">  </span><span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="mi">81</span><span class="n">C4</span><span class="w"> </span><span class="mi">30010000</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="n">esp</span><span class="p">,</span><span class="mi">130</span><span class="w"></span>
<span class="mi">00401145</span><span class="w">  </span><span class="err">\</span><span class="p">.</span><span class="w">  </span><span class="n">C3</span><span class="w">            </span><span class="n">retn</span><span class="w"></span>
</code></pre></div>

<p>在<code>00401059</code>即InputFunction处输入测试用的Name：abcde，并回车。之后程序跑到<code>004010C1</code>即InputSerial处，查看栈数据：</p>
<div class="highlight"><pre><span></span><code><span class="mf">0018</span><span class="n">FDEC</span>   <span class="mf">00000005</span>
<span class="mf">0018</span><span class="n">FDF0</span>   <span class="mf">0018</span><span class="n">FF88</span>
<span class="mf">0018</span><span class="n">FDF4</span>   <span class="mf">004011</span><span class="n">B5</span>  <span class="n">Easy_Key</span><span class="mf">.004011</span><span class="n">B5</span>
<span class="mf">0018</span><span class="n">FDF8</span>   <span class="mf">00000004</span>
<span class="mf">0018</span><span class="n">FDFC</span>   <span class="mf">0040109</span><span class="n">F</span>  <span class="n">Easy_Key</span><span class="mf">.0040109</span><span class="n">F</span>
<span class="mf">0018</span><span class="n">FE00</span>   <span class="mf">0018</span><span class="n">FE84</span>  <span class="nb">ASC</span><span class="n">II</span> <span class="s">&quot;7142537445&quot;</span>
<span class="mf">0018</span><span class="n">FE04</span>   <span class="mf">00408054</span>  <span class="nb">ASC</span><span class="n">II</span> <span class="s">&quot;%s%02X&quot;</span>
<span class="mf">0018</span><span class="n">FE08</span>   <span class="mf">0018</span><span class="n">FE84</span>  <span class="nb">ASC</span><span class="n">II</span> <span class="s">&quot;7142537445&quot;</span>
<span class="mf">0018</span><span class="n">FE0C</span>   <span class="mf">00000045</span>
<span class="mf">0018</span><span class="n">FE10</span>   <span class="mf">00000000</span>
</code></pre></div>

<p>可以看到当Name为abcde的时候，栈在InputSerial前有数据<code>ASCII "7142537445"</code>出现。通过InputSerial之后程序逻辑可以看出，这段字符串就是根据abcde算出的序列号，并用这个序列号和输入的序列号做对比。因此序列号算法在输入名字后、输入序列号之前(<code>0040105E</code>-<code>004010B4</code>)。</p>
<p>这段程序还原成C++代码后基本如下：</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span><span class="cp"></span>
<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">num</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mh">0x10</span><span class="p">,</span><span class="w"> </span><span class="mh">0x20</span><span class="p">,</span><span class="w"> </span><span class="mh">0x30</span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;abcde&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">serial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">char</span><span class="p">[</span><span class="n">len</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="n">serial</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">sprintf</span><span class="p">(</span><span class="n">serial</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%s%02x&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">serial</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">serial</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>因此可以写出反函数：</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span><span class="cp"></span>
<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">num</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mh">0x10</span><span class="p">,</span><span class="w"> </span><span class="mh">0x20</span><span class="p">,</span><span class="w"> </span><span class="mh">0x30</span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">serial</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;7142537445&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">serial</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">char</span><span class="p">[</span><span class="n">len</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">serial</span><span class="p">);</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">serial_str</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="n">serial_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">serial</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">serial_str</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">serial</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">serial_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="n">sprintf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%s%c&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">strtol</span><span class="p">(</span><span class="n">serial_str</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">name</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>把serial用5B134977135E7D13带入跑出来Name为K3yg3nm3。</p>
<h1>Easy Unpack</h1>
<p>readme说需要找OEP，也就是不用脱壳，只需要找入口点。PEiD看一下，壳类型为<code>ARVID's TDR file [Overlay] *</code>。才疏学浅，没看到过……不过既然是Easy Unpack，料着也不会难倒哪里去。</p>
<p>打开OD，载入程序，忽略各种错误。程序开始载入kernel32之后用了LoadLibrary、GetModuleHandle和FreeLibrary，典型的包装了IAT的壳。</p>
<div class="highlight"><pre><span></span><code><span class="mf">0040</span><span class="n">A04B</span> <span class="o">&gt;</span>  <span class="mf">68</span> <span class="mf">00</span><span class="n">A04000</span>     <span class="n">push</span> <span class="n">Easy_Unp</span><span class="mf">.0040</span><span class="n">A000</span>                   <span class="p">;</span> <span class="nb">ASC</span><span class="n">II</span> <span class="s">&quot;kernel32.dll&quot;</span>
<span class="mf">0040</span><span class="n">A050</span>    <span class="n">FF15</span> <span class="mf">0</span><span class="n">DA04000</span>   <span class="n">call</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="o">&lt;</span><span class="err">&amp;</span><span class="n">kernel32</span><span class="mf">.</span><span class="kr">Load</span><span class="n">Librar</span><span class="o">&gt;</span><span class="p">;</span> <span class="n">kernel32</span><span class="mf">.</span><span class="kr">Load</span><span class="n">LibraryA</span>
<span class="mf">0040</span><span class="n">A056</span>    <span class="n">A3</span> <span class="mf">44</span><span class="n">A64000</span>     <span class="n">mov</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="mf">40</span><span class="n">A644</span><span class="err">]</span><span class="p">,</span><span class="n">eax</span>
<span class="mf">0040</span><span class="n">A05B</span>    <span class="mf">68</span> <span class="mf">18</span><span class="n">A64000</span>     <span class="n">push</span> <span class="n">Easy_Unp</span><span class="mf">.0040</span><span class="n">A618</span>                   <span class="p">;</span> <span class="nb">ASC</span><span class="n">II</span> <span class="s">&quot;GetModuleHandleA&quot;</span>
<span class="mf">0040</span><span class="n">A060</span>    <span class="mf">50</span>              <span class="n">push</span> <span class="n">eax</span>
<span class="mf">0040</span><span class="n">A061</span>    <span class="n">FF15</span> <span class="mf">11</span><span class="n">A04000</span>   <span class="n">call</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="o">&lt;</span><span class="err">&amp;</span><span class="n">kernel32</span><span class="mf">.</span><span class="kr">Get</span><span class="n">ProcAdd</span><span class="o">&gt;</span><span class="p">;</span> <span class="n">apphelp</span><span class="mf">.7054</span><span class="n">FFF6</span>
<span class="mf">0040</span><span class="n">A067</span>    <span class="n">A3</span> <span class="mf">48</span><span class="n">A64000</span>     <span class="n">mov</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="mf">40</span><span class="n">A648</span><span class="err">]</span><span class="p">,</span><span class="n">eax</span>
<span class="mf">0040</span><span class="n">A06C</span>    <span class="mf">68</span> <span class="mf">29</span><span class="n">A64000</span>     <span class="n">push</span> <span class="n">Easy_Unp</span><span class="mf">.0040</span><span class="n">A629</span>                   <span class="p">;</span> <span class="nb">ASC</span><span class="n">II</span> <span class="s">&quot;FreeLibrary&quot;</span>
<span class="mf">0040</span><span class="n">A071</span>    <span class="n">FF35</span> <span class="mf">44</span><span class="n">A64000</span>   <span class="n">push</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="mf">40</span><span class="n">A644</span><span class="err">]</span>
<span class="mf">0040</span><span class="n">A077</span>    <span class="n">FF15</span> <span class="mf">11</span><span class="n">A04000</span>   <span class="n">call</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="o">&lt;</span><span class="err">&amp;</span><span class="n">kernel32</span><span class="mf">.</span><span class="kr">Get</span><span class="n">ProcAdd</span><span class="o">&gt;</span><span class="p">;</span> <span class="n">apphelp</span><span class="mf">.7054</span><span class="n">FFF6</span>
<span class="mf">0040</span><span class="n">A07D</span>    <span class="n">A3</span> <span class="mf">4</span><span class="n">CA64000</span>     <span class="n">mov</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="mf">40</span><span class="n">A64C</span><span class="err">]</span><span class="p">,</span><span class="n">eax</span>
</code></pre></div>

<p>之后是很长一段外壳操作，直到一个长<code>jmp</code>：</p>
<div class="highlight"><pre><span></span><code><span class="mi">0040</span><span class="n">A082</span><span class="w">    </span><span class="mi">6</span><span class="n">A</span><span class="w"> </span><span class="mi">00</span><span class="w">           </span><span class="n">push</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="mi">0040</span><span class="n">A084</span><span class="w">    </span><span class="n">FF15</span><span class="w"> </span><span class="mi">48</span><span class="n">A64000</span><span class="w">   </span><span class="k">call</span><span class="w"> </span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ds</span><span class="p">:</span><span class="o">[</span><span class="n">40A648</span><span class="o">]</span><span class="w"></span>
<span class="mi">0040</span><span class="n">A08A</span><span class="w">    </span><span class="n">A3</span><span class="w"> </span><span class="mi">50</span><span class="n">A64000</span><span class="w">     </span><span class="n">mov</span><span class="w"> </span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ds</span><span class="p">:</span><span class="o">[</span><span class="n">40A650</span><span class="o">]</span><span class="p">,</span><span class="n">eax</span><span class="w"></span>
<span class="mi">0040</span><span class="n">A08F</span><span class="w">    </span><span class="n">B9</span><span class="w"> </span><span class="mi">00904000</span><span class="w">     </span><span class="n">mov</span><span class="w"> </span><span class="n">ecx</span><span class="p">,</span><span class="n">Easy_Unp</span><span class="mf">.00409000</span><span class="w"></span>
<span class="mi">0040</span><span class="n">A094</span><span class="w">    </span><span class="n">BA</span><span class="w"> </span><span class="n">EE944000</span><span class="w">     </span><span class="n">mov</span><span class="w"> </span><span class="n">edx</span><span class="p">,</span><span class="n">Easy_Unp</span><span class="mf">.004094</span><span class="n">EE</span><span class="w"></span>
<span class="mi">0040</span><span class="n">A099</span><span class="w">    </span><span class="mi">3</span><span class="n">BCA</span><span class="w">            </span><span class="n">cmp</span><span class="w"> </span><span class="n">ecx</span><span class="p">,</span><span class="n">edx</span><span class="w"></span>
<span class="mi">0040</span><span class="n">A09B</span><span class="w">    </span><span class="mi">74</span><span class="w"> </span><span class="mi">26</span><span class="w">           </span><span class="n">je</span><span class="w"> </span><span class="n">short</span><span class="w"> </span><span class="n">Easy_Unp</span><span class="mf">.0040</span><span class="n">A0C3</span><span class="w"></span>
<span class="mi">0040</span><span class="n">A09D</span><span class="w">    </span><span class="mi">8031</span><span class="w"> </span><span class="mi">10</span><span class="w">         </span><span class="n">xor</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ds</span><span class="p">:</span><span class="o">[</span><span class="n">ecx</span><span class="o">]</span><span class="p">,</span><span class="mi">10</span><span class="w"></span>
<span class="mi">0040</span><span class="n">A0A0</span><span class="w">    </span><span class="mi">41</span><span class="w">              </span><span class="n">inc</span><span class="w"> </span><span class="n">ecx</span><span class="w"></span>
<span class="mi">0040</span><span class="n">A0A1</span><span class="w">    </span><span class="mi">3</span><span class="n">BCA</span><span class="w">            </span><span class="n">cmp</span><span class="w"> </span><span class="n">ecx</span><span class="p">,</span><span class="n">edx</span><span class="w"></span>
<span class="mi">0040</span><span class="n">A0A3</span><span class="w">    </span><span class="mi">74</span><span class="w"> </span><span class="mi">1</span><span class="n">E</span><span class="w">           </span><span class="n">je</span><span class="w"> </span><span class="n">short</span><span class="w"> </span><span class="n">Easy_Unp</span><span class="mf">.0040</span><span class="n">A0C3</span><span class="w"></span>

<span class="p">...</span><span class="w"></span>

<span class="mi">0040</span><span class="n">A1ED</span><span class="w">    </span><span class="mi">8031</span><span class="w"> </span><span class="mi">40</span><span class="w">         </span><span class="n">xor</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ds</span><span class="p">:</span><span class="o">[</span><span class="n">ecx</span><span class="o">]</span><span class="p">,</span><span class="mi">40</span><span class="w"></span>
<span class="mi">0040</span><span class="n">A1F0</span><span class="w">    </span><span class="mi">41</span><span class="w">              </span><span class="n">inc</span><span class="w"> </span><span class="n">ecx</span><span class="w"></span>
<span class="mi">0040</span><span class="n">A1F1</span><span class="w">    </span><span class="mi">3</span><span class="n">BCA</span><span class="w">            </span><span class="n">cmp</span><span class="w"> </span><span class="n">ecx</span><span class="p">,</span><span class="n">edx</span><span class="w"></span>
<span class="mi">0040</span><span class="n">A1F3</span><span class="w">    </span><span class="mi">74</span><span class="w"> </span><span class="mi">06</span><span class="w">           </span><span class="n">je</span><span class="w"> </span><span class="n">short</span><span class="w"> </span><span class="n">Easy_Unp</span><span class="mf">.0040</span><span class="n">A1FB</span><span class="w"></span>
<span class="mi">0040</span><span class="n">A1F5</span><span class="w">    </span><span class="mi">8031</span><span class="w"> </span><span class="mi">50</span><span class="w">         </span><span class="n">xor</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="nl">ds</span><span class="p">:</span><span class="o">[</span><span class="n">ecx</span><span class="o">]</span><span class="p">,</span><span class="mi">50</span><span class="w"></span>
<span class="mi">0040</span><span class="n">A1F8</span><span class="w">    </span><span class="mi">41</span><span class="w">              </span><span class="n">inc</span><span class="w"> </span><span class="n">ecx</span><span class="w"></span>
<span class="mi">0040</span><span class="n">A1F9</span><span class="w">  </span><span class="o">^</span><span class="w"> </span><span class="n">EB</span><span class="w"> </span><span class="n">D6</span><span class="w">           </span><span class="n">jmp</span><span class="w"> </span><span class="n">short</span><span class="w"> </span><span class="n">Easy_Unp</span><span class="mf">.0040</span><span class="n">A1D1</span><span class="w"></span>
<span class="mi">0040</span><span class="n">A1FB</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">E9</span><span class="w"> </span><span class="mi">506</span><span class="n">FFFFF</span><span class="w">     </span><span class="n">jmp</span><span class="w"> </span><span class="n">Easy_Unp</span><span class="mf">.00401150</span><span class="w"></span>
</code></pre></div>

<p>程序单步到0040A1FB之后，长跳到00401150，发现二进制数据是55，条件反射<code>push ebp</code>，函数入口，于是Ctrl+A强制汇编数据，熟悉的入口结构来了~~</p>
<div class="highlight"><pre><span></span><code><span class="mf">00401150</span>  <span class="o">/</span><span class="mf">.</span>  <span class="mf">55</span>            <span class="n">push</span> <span class="n">ebp</span>
<span class="mf">00401151</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">8</span><span class="n">BEC</span>          <span class="n">mov</span> <span class="n">ebp</span><span class="p">,</span><span class="n">esp</span>
<span class="mf">00401153</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">6</span><span class="n">A</span> <span class="n">FF</span>         <span class="n">push</span> <span class="o">-</span><span class="mf">1</span>
<span class="mf">00401155</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">68</span> <span class="n">D0504000</span>   <span class="n">push</span> <span class="n">Easy_Unp</span><span class="mf">.004050</span><span class="n">D0</span>
<span class="mf">0040115</span><span class="n">A</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">68</span> <span class="mf">1</span><span class="n">C1E4000</span>   <span class="n">push</span> <span class="n">Easy_Unp</span><span class="mf">.00401E1</span><span class="n">C</span>                   <span class="p">;</span>  <span class="n">Entry</span> <span class="n">address</span><span class="p">;</span> <span class="n">SE</span> <span class="n">处理程序安装</span>
<span class="mf">0040115</span><span class="n">F</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">64</span><span class="p">:</span><span class="n">A1</span> <span class="mf">0000000</span><span class="o">&gt;</span><span class="n">mov</span> <span class="n">eax</span><span class="p">,</span><span class="n">dword</span> <span class="n">ptr</span> <span class="n">fs</span><span class="p">:</span><span class="err">[</span><span class="mf">0</span><span class="err">]</span>
<span class="mf">00401165</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">50</span>            <span class="n">push</span> <span class="n">eax</span>
<span class="mf">00401166</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">64</span><span class="p">:</span><span class="mf">8925</span> <span class="mf">00000</span><span class="o">&gt;</span><span class="n">mov</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="n">fs</span><span class="p">:</span><span class="err">[</span><span class="mf">0</span><span class="err">]</span><span class="p">,</span><span class="n">esp</span>
<span class="mf">0040116</span><span class="n">D</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">83</span><span class="n">EC</span> <span class="mf">58</span>       <span class="n">sub</span> <span class="n">esp</span><span class="p">,</span><span class="mf">58</span>

<span class="mf">...</span>

<span class="mf">004011</span><span class="n">BC</span>  <span class="err">|</span><span class="o">&gt;</span>  <span class="mf">8975</span> <span class="n">FC</span>       <span class="n">mov</span> <span class="err">[</span><span class="n">local</span><span class="mf">.1</span><span class="err">]</span><span class="p">,</span><span class="n">esi</span>
<span class="mf">004011</span><span class="n">BF</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">E8</span> <span class="n">E1070000</span>   <span class="n">call</span> <span class="n">Easy_Unp</span><span class="mf">.004019</span><span class="n">A5</span>
<span class="mf">004011</span><span class="n">C4</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">FF15</span> <span class="mf">38504000</span> <span class="n">call</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="mf">405038</span><span class="err">]</span>               <span class="p">;</span> <span class="err">[</span><span class="kr">Get</span><span class="n">CommandLineA</span>

<span class="mf">...</span>

<span class="mf">004011</span><span class="n">EE</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">50</span>            <span class="n">push</span> <span class="n">eax</span>                                 <span class="p">;</span> <span class="o">/</span><span class="n">pStartupinfo</span>
<span class="mf">004011</span><span class="n">EF</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">FF15</span> <span class="mf">34504000</span> <span class="n">call</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="mf">405034</span><span class="err">]</span>               <span class="p">;</span> <span class="err">\</span><span class="kr">Get</span><span class="n">StartupInfoA</span>
<span class="mf">004011</span><span class="n">F5</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">E8</span> <span class="mf">1</span><span class="n">B030000</span>   <span class="n">call</span> <span class="n">Easy_Unp</span><span class="mf">.00401515</span>

<span class="mf">...</span>

<span class="mf">0040120</span><span class="n">C</span>  <span class="err">|</span><span class="o">&gt;</span>  <span class="mf">50</span>            <span class="n">push</span> <span class="n">eax</span>
<span class="mf">0040120</span><span class="n">D</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">FF75</span> <span class="mf">9</span><span class="n">C</span>       <span class="n">push</span> <span class="err">[</span><span class="n">local</span><span class="mf">.25</span><span class="err">]</span>
<span class="mf">00401210</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">56</span>            <span class="n">push</span> <span class="n">esi</span>
<span class="mf">00401211</span>  <span class="err">|</span><span class="mf">.</span>  <span class="mf">56</span>            <span class="n">push</span> <span class="n">esi</span>                                 <span class="p">;</span> <span class="o">/</span><span class="n">pModule</span>
<span class="mf">00401212</span>  <span class="err">|</span><span class="mf">.</span>  <span class="n">FF15</span> <span class="mf">30504000</span> <span class="n">call</span> <span class="n">dword</span> <span class="n">ptr</span> <span class="n">ds</span><span class="p">:</span><span class="err">[</span><span class="mf">405030</span><span class="err">]</span>               <span class="p">;</span> <span class="err">\</span><span class="kr">Get</span><span class="n">ModuleHandleA</span>
</code></pre></div>

<p>因此OEP为00401150。确实非常简单~~</p>
<h1>Easy ELF</h1>
<p>三道Windows之后来了一道Linux，不过无所谓啦。拖到Linux里面，看一下文件类型。</p>
<div class="highlight"><pre><span></span><code>root@YYX-Kali:~/upload# file Easy_ELF 
Easy_ELF: ELF <span class="m">32</span>-bit LSB executable, Intel <span class="m">80386</span>, version <span class="m">1</span> <span class="o">(</span>SYSV<span class="o">)</span>, dynamically linked <span class="o">(</span>uses shared libs<span class="o">)</span>, <span class="k">for</span> GNU/Linux <span class="m">2</span>.6.15, BuildID<span class="o">[</span>sha1<span class="o">]=</span>0x409edb8e3182380a2f58d49c7323dd895c74e1b7, stripped
</code></pre></div>

<p>基本信息就是ELF32位可执行文件，链接动态库，去符号表。</p>
<p>运行一下程序，随便输入一点，提示<code>Wrong</code>后直接退出。反复试了一些数字、字母之类的组合，都是一个结果。</p>
<p>打开IDA（Windows下），拖入，开始逆向分析。直接<code>Shift+F12</code>打开字符串窗口找到找到<code>Wrong</code>，之后利用交叉引用跳回到调用函数，稍微向上翻一点就能看到关键函数了：</p>
<div class="highlight"><pre><span></span><code><span class="nl">.text:</span><span class="err">080484</span><span class="nf">F7</span> <span class="c1">; =============== S U B R O U T I N E =======================================</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">F7</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">F7</span> <span class="c1">; Attributes: bp-based frame</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">F7</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">F7</span> <span class="no">sub_80484F7</span>     <span class="no">proc</span> <span class="no">near</span>               <span class="c1">; CODE XREF: sub_804851B+34p</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">F7</span>                 <span class="no">push</span>    <span class="no">ebp</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">F8</span>                 <span class="no">mov</span>     <span class="no">ebp</span><span class="p">,</span> <span class="no">esp</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">FA</span>                 <span class="no">sub</span>     <span class="no">esp</span><span class="p">,</span> <span class="mi">18</span><span class="no">h</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">FD</span>                 <span class="no">mov</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">8</span><span class="p">],</span> <span class="mi">9</span> <span class="c1">; n</span>
<span class="nl">.text:</span><span class="err">08048505</span>                 <span class="nf">mov</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">4</span><span class="p">],</span> <span class="no">offset</span> <span class="no">aCorrect</span> <span class="c1">; &quot;Correct!\n&quot;</span>
<span class="nl">.text:</span><span class="err">0804850</span><span class="nf">D</span>                 <span class="no">mov</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">esp</span><span class="p">],</span> <span class="mi">1</span> <span class="c1">; fd</span>
<span class="nl">.text:</span><span class="err">08048514</span>                 <span class="nf">call</span>    <span class="no">_write</span>
<span class="nl">.text:</span><span class="err">08048519</span>                 <span class="nf">leave</span>
<span class="nl">.text:</span><span class="err">0804851</span><span class="nf">A</span>                 <span class="no">retn</span>
<span class="nl">.text:</span><span class="err">0804851</span><span class="nf">A</span> <span class="no">sub_80484F7</span>     <span class="no">endp</span>
<span class="nl">.text:</span><span class="err">0804851</span><span class="nf">A</span>
<span class="nl">.text:</span><span class="err">0804851</span><span class="nf">B</span>
<span class="nl">.text:</span><span class="err">0804851</span><span class="nf">B</span> <span class="c1">; =============== S U B R O U T I N E =======================================</span>
<span class="nl">.text:</span><span class="err">0804851</span><span class="nf">B</span>
<span class="nl">.text:</span><span class="err">0804851</span><span class="nf">B</span> <span class="c1">; Attributes: bp-based frame</span>
<span class="nl">.text:</span><span class="err">0804851</span><span class="nf">B</span>
<span class="nl">.text:</span><span class="err">0804851</span><span class="nf">B</span> <span class="no">sub_804851B</span>     <span class="no">proc</span> <span class="no">near</span>               <span class="c1">; DATA XREF: start+17o</span>
<span class="nl">.text:</span><span class="err">0804851</span><span class="nf">B</span>                 <span class="no">push</span>    <span class="no">ebp</span>
<span class="nl">.text:</span><span class="err">0804851</span><span class="nf">C</span>                 <span class="no">mov</span>     <span class="no">ebp</span><span class="p">,</span> <span class="no">esp</span>
<span class="nl">.text:</span><span class="err">0804851</span><span class="nf">E</span>                 <span class="no">and</span>     <span class="no">esp</span><span class="p">,</span> <span class="mi">0</span><span class="no">FFFFFFF0h</span>
<span class="nl">.text:</span><span class="err">08048521</span>                 <span class="nf">sub</span>     <span class="no">esp</span><span class="p">,</span> <span class="mi">10</span><span class="no">h</span>
<span class="nl">.text:</span><span class="err">08048524</span>                 <span class="nf">mov</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">8</span><span class="p">],</span> <span class="mi">17</span><span class="no">h</span> <span class="c1">; n</span>
<span class="nl">.text:</span><span class="err">0804852</span><span class="nf">C</span>                 <span class="no">mov</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">4</span><span class="p">],</span> <span class="no">offset</span> <span class="no">aReversing_krEa</span> <span class="c1">; &quot;Reversing.Kr Easy ELF\n\n&quot;</span>
<span class="nl">.text:</span><span class="err">08048534</span>                 <span class="nf">mov</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">esp</span><span class="p">],</span> <span class="mi">1</span> <span class="c1">; fd</span>
<span class="nl">.text:</span><span class="err">0804853</span><span class="nf">B</span>                 <span class="no">call</span>    <span class="no">_write</span>
<span class="nl">.text:</span><span class="err">08048540</span>                 <span class="nf">call</span>    <span class="no">sub_8048434</span>              <span class="c1">; scanf</span>
<span class="nl">.text:</span><span class="err">08048545</span>                 <span class="nf">call</span>    <span class="no">sub_8048451</span>              <span class="c1">; main algorithm</span>
<span class="nl">.text:</span><span class="err">0804854</span><span class="nf">A</span>                 <span class="no">cmp</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">1</span>
<span class="nl">.text:</span><span class="err">0804854</span><span class="nf">D</span>                 <span class="no">jnz</span>     <span class="no">short</span> <span class="no">loc_804855B</span>
<span class="nl">.text:</span><span class="err">0804854</span><span class="nf">F</span>                 <span class="no">call</span>    <span class="no">sub_80484F7</span>              <span class="c1">; correct</span>
<span class="nl">.text:</span><span class="err">08048554</span>                 <span class="nf">mov</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="nl">.text:</span><span class="err">08048559</span>                 <span class="nf">jmp</span>     <span class="no">short</span> <span class="no">locret_804857C</span>
<span class="nl">.text:</span><span class="err">0804855</span><span class="nf">B</span> <span class="c1">; ---------------------------------------------------------------------------</span>
<span class="nl">.text:</span><span class="err">0804855</span><span class="nf">B</span>
<span class="nl">.text:</span><span class="err">0804855</span><span class="nf">B</span> <span class="no">loc_804855B</span><span class="p">:</span>                            <span class="c1">; CODE XREF: sub_804851B+32j</span>
<span class="nl">.text:</span><span class="err">0804855</span><span class="nf">B</span>                 <span class="no">mov</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">8</span><span class="p">],</span> <span class="mi">6</span> <span class="c1">; n</span>
<span class="nl">.text:</span><span class="err">08048563</span>                 <span class="nf">mov</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">esp</span><span class="err">+</span><span class="mi">4</span><span class="p">],</span> <span class="no">offset</span> <span class="no">aWrong</span> <span class="c1">; &quot;Wrong\n&quot;</span>
<span class="nl">.text:</span><span class="err">0804856</span><span class="nf">B</span>                 <span class="no">mov</span>     <span class="no">dword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">esp</span><span class="p">],</span> <span class="mi">1</span> <span class="c1">; fd</span>
<span class="nl">.text:</span><span class="err">08048572</span>                 <span class="nf">call</span>    <span class="no">_write</span>
<span class="nl">.text:</span><span class="err">08048577</span>                 <span class="nf">mov</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="nl">.text:</span><span class="err">0804857</span><span class="nf">C</span>
<span class="nl">.text:</span><span class="err">0804857</span><span class="nf">C</span> <span class="no">locret_804857C</span><span class="p">:</span>                         <span class="c1">; CODE XREF: sub_804851B+3Ej</span>
<span class="nl">.text:</span><span class="err">0804857</span><span class="nf">C</span>                 <span class="no">leave</span>
<span class="nl">.text:</span><span class="err">0804857</span><span class="nf">D</span>                 <span class="no">retn</span>
<span class="nl">.text:</span><span class="err">0804857</span><span class="nf">D</span> <span class="no">sub_804851B</span>     <span class="no">endp</span>
<span class="nl">.text:</span><span class="err">0804857</span><span class="nf">D</span>
<span class="nl">.text:</span><span class="err">0804857</span><span class="nf">D</span> <span class="c1">; ---------------------------------------------------------------------------</span>
</code></pre></div>

<p>sub_804851B函数是提示正确与错误的分支函数，其中四个call，write识别出来了，其他函数跟进去看一下（我已经注释），发现是scanf、主算法函数和返回Correct字符串的函数，其中当主算法函数返回1时判为正确。</p>
<p>然后就重点来看sub_8048451。转到图形视图，一组连续判断，只要逻辑沿着右边下来即可走通（最后eax为1，符合上面的判对条件）。</p>
<p><img alt="IDA" src="/statics/reversing-kr-4-easy-challenges/2014-09-13_153330.jpg"></p>
<p>之后大致扫描了一下程序体，发现反复调用ds段寄存器指向的段内的一些byte，点进去看一下数据区布局（在.bss段，全局变量）。</p>
<div class="highlight"><pre><span></span><code><span class="nl">.bss:</span><span class="err">0804</span><span class="nf">A020</span> <span class="no">byte_804A020</span>    <span class="no">db</span> <span class="err">?</span>                    <span class="c1">; DATA XREF: sub_8048434+Bo</span>
<span class="nl">.bss:</span><span class="err">0804</span><span class="nf">A020</span>                                         <span class="c1">; sub_8048451:loc_8048469r ...</span>
<span class="nl">.bss:</span><span class="err">0804</span><span class="nf">A021</span> <span class="no">byte_804A021</span>    <span class="no">db</span> <span class="err">?</span>                    <span class="c1">; DATA XREF: sub_8048451+3r</span>
<span class="nl">.bss:</span><span class="err">0804</span><span class="nf">A022</span> <span class="no">byte_804A022</span>    <span class="no">db</span> <span class="err">?</span>                    <span class="c1">; DATA XREF: sub_8048451+27r</span>
<span class="nl">.bss:</span><span class="err">0804</span><span class="nf">A022</span>                                         <span class="c1">; sub_8048451+31w ...</span>
<span class="nl">.bss:</span><span class="err">0804</span><span class="nf">A023</span> <span class="no">byte_804A023</span>    <span class="no">db</span> <span class="err">?</span>                    <span class="c1">; DATA XREF: sub_8048451+36r</span>
<span class="nl">.bss:</span><span class="err">0804</span><span class="nf">A023</span>                                         <span class="c1">; sub_8048451+40w ...</span>
<span class="nl">.bss:</span><span class="err">0804</span><span class="nf">A024</span> <span class="no">byte_804A024</span>    <span class="no">db</span> <span class="err">?</span>                    <span class="c1">; DATA XREF: sub_8048451+45r</span>
<span class="nl">.bss:</span><span class="err">0804</span><span class="nf">A025</span> <span class="no">byte_804A025</span>    <span class="no">db</span> <span class="err">?</span>                    <span class="c1">; DATA XREF: sub_8048451:loc_80484A8r</span>
</code></pre></div>

<p>这段都是被引用数据，且是连续的，各1byte，你可以把它们格式化成数组，我比较懒，就不做这步了。基本可以确认数据区为连续的6个byte，即[20][21][22][23][24][25]。</p>
<p>下面进行主算法具体逻辑分析：</p>
<div class="highlight"><pre><span></span><code><span class="nl">.text:</span><span class="err">08048451</span> <span class="nf">sub_8048451</span>     <span class="no">proc</span> <span class="no">near</span>               <span class="c1">; CODE XREF: sub_804851B+2Ap</span>
<span class="nl">.text:</span><span class="err">08048451</span>                 <span class="nf">push</span>    <span class="no">ebp</span>
<span class="nl">.text:</span><span class="err">08048452</span>                 <span class="nf">mov</span>     <span class="no">ebp</span><span class="p">,</span> <span class="no">esp</span>
<span class="nl">.text:</span><span class="err">08048454</span>                 <span class="nf">movzx</span>   <span class="no">eax</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A021</span>
<span class="nl">.text:</span><span class="err">0804845</span><span class="nf">B</span>                 <span class="no">cmp</span>     <span class="no">al</span><span class="p">,</span> <span class="mi">31</span><span class="no">h</span>
<span class="nl">.text:</span><span class="err">0804845</span><span class="nf">D</span>                 <span class="no">jz</span>      <span class="no">short</span> <span class="no">loc_8048469</span>
<span class="nl">.text:</span><span class="err">0804845</span><span class="nf">F</span>                 <span class="no">mov</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="nl">.text:</span><span class="err">08048464</span>                 <span class="nf">jmp</span>     <span class="no">loc_80484F5</span>
</code></pre></div>

<p>第一段确定[21]等于0x31，就是'1'。</p>
<div class="highlight"><pre><span></span><code><span class="nl">.text:</span><span class="err">08048469</span> <span class="nl">loc_8048469:</span>                            <span class="c1">; CODE XREF: sub_8048451+Cj</span>
<span class="nl">.text:</span><span class="err">08048469</span>                 <span class="nf">movzx</span>   <span class="no">eax</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A020</span>
<span class="nl">.text:</span><span class="err">08048470</span>                 <span class="nf">xor</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">34</span><span class="no">h</span>
<span class="nl">.text:</span><span class="err">08048473</span>                 <span class="nf">mov</span>     <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A020</span><span class="p">,</span> <span class="no">al</span>
<span class="nl">.text:</span><span class="err">08048478</span>                 <span class="nf">movzx</span>   <span class="no">eax</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A022</span>
<span class="nl">.text:</span><span class="err">0804847</span><span class="nf">F</span>                 <span class="no">xor</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">32</span><span class="no">h</span>
<span class="nl">.text:</span><span class="err">08048482</span>                 <span class="nf">mov</span>     <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A022</span><span class="p">,</span> <span class="no">al</span>
<span class="nl">.text:</span><span class="err">08048487</span>                 <span class="nf">movzx</span>   <span class="no">eax</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A023</span>
<span class="nl">.text:</span><span class="err">0804848</span><span class="nf">E</span>                 <span class="no">xor</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span><span class="no">FFFFFF88h</span>
<span class="nl">.text:</span><span class="err">08048491</span>                 <span class="nf">mov</span>     <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A023</span><span class="p">,</span> <span class="no">al</span>
<span class="nl">.text:</span><span class="err">08048496</span>                 <span class="nf">movzx</span>   <span class="no">eax</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A024</span>
<span class="nl">.text:</span><span class="err">0804849</span><span class="nf">D</span>                 <span class="no">cmp</span>     <span class="no">al</span><span class="p">,</span> <span class="mi">58</span><span class="no">h</span>
<span class="nl">.text:</span><span class="err">0804849</span><span class="nf">F</span>                 <span class="no">jz</span>      <span class="no">short</span> <span class="no">loc_80484A8</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">A1</span>                 <span class="no">mov</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">A6</span>                 <span class="no">jmp</span>     <span class="no">short</span> <span class="no">loc_80484F5</span>
</code></pre></div>

<p>第二段做了连续异或，[20] xor 0x34, [22] xor 0x32, [23] xor 0x88, 之后判断[23]是不是为0x58，所以[23]为'X'。</p>
<div class="highlight"><pre><span></span><code><span class="nl">.text:</span><span class="err">080484</span><span class="nf">A8</span> <span class="no">loc_80484A8</span><span class="p">:</span>                            <span class="c1">; CODE XREF: sub_8048451+4Ej</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">A8</span>                 <span class="no">movzx</span>   <span class="no">eax</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A025</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">AF</span>                 <span class="no">test</span>    <span class="no">al</span><span class="p">,</span> <span class="no">al</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">B1</span>                 <span class="no">jz</span>      <span class="no">short</span> <span class="no">loc_80484BA</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">B3</span>                 <span class="no">mov</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">B8</span>                 <span class="no">jmp</span>     <span class="no">short</span> <span class="no">loc_80484F5</span>
</code></pre></div>

<p>第三段要求[25]为0，就是'\0'，字符串结尾。</p>
<div class="highlight"><pre><span></span><code><span class="nl">.text:</span><span class="err">080484</span><span class="nf">BA</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">BA</span> <span class="no">loc_80484BA</span><span class="p">:</span>                            <span class="c1">; CODE XREF: sub_8048451+60j</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">BA</span>                 <span class="no">movzx</span>   <span class="no">eax</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A022</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">C1</span>                 <span class="no">cmp</span>     <span class="no">al</span><span class="p">,</span> <span class="mi">7</span><span class="no">Ch</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">C3</span>                 <span class="no">jz</span>      <span class="no">short</span> <span class="no">loc_80484CC</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">C5</span>                 <span class="no">mov</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">CA</span>                 <span class="no">jmp</span>     <span class="no">short</span> <span class="no">loc_80484F5</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">CC</span> <span class="c1">; ---------------------------------------------------------------------------</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">CC</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">CC</span> <span class="no">loc_80484CC</span><span class="p">:</span>                            <span class="c1">; CODE XREF: sub_8048451+72j</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">CC</span>                 <span class="no">movzx</span>   <span class="no">eax</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A020</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">D3</span>                 <span class="no">cmp</span>     <span class="no">al</span><span class="p">,</span> <span class="mi">78</span><span class="no">h</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">D5</span>                 <span class="no">jz</span>      <span class="no">short</span> <span class="no">loc_80484DE</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">D7</span>                 <span class="no">mov</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">DC</span>                 <span class="no">jmp</span>     <span class="no">short</span> <span class="no">loc_80484F5</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">DE</span> <span class="c1">; ---------------------------------------------------------------------------</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">DE</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">DE</span> <span class="no">loc_80484DE</span><span class="p">:</span>                            <span class="c1">; CODE XREF: sub_8048451+84j</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">DE</span>                 <span class="no">movzx</span>   <span class="no">eax</span><span class="p">,</span> <span class="no">ds</span><span class="p">:</span><span class="no">byte_804A023</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">E5</span>                 <span class="no">cmp</span>     <span class="no">al</span><span class="p">,</span> <span class="mi">0</span><span class="no">DDh</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">E7</span>                 <span class="no">jz</span>      <span class="no">short</span> <span class="no">loc_80484F0</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">E9</span>                 <span class="no">mov</span>     <span class="no">eax</span><span class="p">,</span> <span class="mi">0</span>
<span class="nl">.text:</span><span class="err">080484</span><span class="nf">EE</span>                 <span class="no">jmp</span>     <span class="no">short</span> <span class="no">loc_80484F5</span>
</code></pre></div>

<p>之后连续三段对刚才异或后的数字进行操作。异或的反函数还是异或，所以直接异或就能得到结果。这里用python计算一下：</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x32</span> <span class="o">^</span> <span class="mh">0x7c</span><span class="p">)</span>
<span class="s1">&#39;N&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x34</span> <span class="o">^</span> <span class="mh">0x78</span><span class="p">)</span>
<span class="s1">&#39;L&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x88</span> <span class="o">^</span> <span class="mh">0xdd</span><span class="p">)</span>
<span class="s1">&#39;U&#39;</span><span class="err">`</span>
</code></pre></div>

<p>所以[20]=L，[22]=N，[23]=U。</p>
<p>最后eax置1并返回。这样可以得到答案为<code>L1NUX</code>。</p>
        </section>

        <br>

        <footer>
          <!-- <div class="adjust-width">
            <div id="author-block" class="w3-light-grey w3-border">
              <div id="author-info">
                <a href=""><img style="width: 60px; height: 60px;" src="/theme/images/cat_avatar.png" onerror="this.src='theme/images/avatar.png'" alt="Avatar"></a>
                <div style="margin-left: 20px; margin-top: 15px;">
                  <a href=""><span id="author-name" class="w3-hover-text-dark-grey">YYX</span></a>
                  <p id="author-story"></p>
                </div>
              </div>
            </div>
          </div>

          <br><br><br> -->

          <p style="font-size:10pt; font-style: italic;">Did you like this article? Share it with your friends!</p>
          <div id="share" class="share">
            <a href="http://www.facebook.com/sharer.php?u=https%3A//blog.yyx.me/posts/reversing-kr-4-easy-challenges/&amp;t=YYX%27s%20Website%3A%20reversing.kr%E5%9B%9B%E9%81%93Easy%E9%A2%98%E8%A7%A3%E9%A2%98%E6%94%BB%E7%95%A5" target="_blank" class="w3-btn yyx-btn-hover">
              <i class="fa fa-facebook"></i> <!-- <span>Facebook</span> -->
            </a>
            <a href="http://twitter.com/share?url=https%3A//blog.yyx.me/posts/reversing-kr-4-easy-challenges/&amp;text=YYX%27s%20Website%3A%20reversing.kr%E5%9B%9B%E9%81%93Easy%E9%A2%98%E8%A7%A3%E9%A2%98%E6%94%BB%E7%95%A5" target="_blank" class="w3-btn yyx-btn-hover">
              <i class="fa fa-twitter"></i> <!-- <span>Twitter</span> -->
            </a>
            <a href="https://plus.google.com/share?url=https%3A//blog.yyx.me/posts/reversing-kr-4-easy-challenges/" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;" class="w3-btn yyx-btn-hover">
              <i class="fa fa-google-plus"></i> <!-- <span>Google</span> -->
            </a>
          </div>

          <br><br><br>


<div id="disqus_thread" class="w3-margin-bottom"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT 
     *  THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR 
     *  PLATFORM OR CMS.
     *  
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: 
     *  https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        // Replace PAGE_URL with your page's canonical URL variable
        this.page.url = PAGE_URL;  
        
        // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        this.page.identifier = PAGE_IDENTIFIER; 
    };
    */
    
    (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document, s = d.createElement('script');
        
        // IMPORTANT: Replace EXAMPLE with your forum shortname!
        s.src = 'https://yyxblog.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>
    Please enable JavaScript to view the 
    <a href="https://disqus.com/?ref_noscript" rel="nofollow">
        comments powered by Disqus.
    </a>
</noscript>

        </footer>
      </div>
    </article>


    <footer id="footer">
      <div id="footer-copyright" class="w3-center w3-text-grey w3-padding-48">
        <span>
          &copy;
          2014&dash;2021          yyx.me
 | <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank"><i class="fa fa-creative-commons" aria-hidden="true"></i></a>        </span>
      </div>
    </footer>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-64342434-1', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>